(()=>{var e={};e.id=702,e.ids=[702],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1004:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(8652),s(8635),s(2874);var r=s(7105),a=s(5265),l=s(157),n=s.n(l),i=s(4665),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let c=["",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8652)),"d:\\PDev\\MeoPanel\\MeoPanel-Client\\front-end\\src\\app\\dashboard\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,8635)),"d:\\PDev\\MeoPanel\\MeoPanel-Client\\front-end\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,2874,23)),"next/dist/client/components/not-found-error"]}],d=["d:\\PDev\\MeoPanel\\MeoPanel-Client\\front-end\\src\\app\\dashboard\\page.tsx"],u="/dashboard/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9859:(e,t,s)=>{Promise.resolve().then(s.bind(s,2847))},2847:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>U,dynamic:()=>z});var r=s(9899),a=s(5271),l=s(5507);let n=(0,l.createContext)(void 0),i=()=>{let e=(0,l.useContext)(n);if(!e)throw Error("useWebSocket must be used within a WebSocketProvider");return e},o=({children:e,user:t})=>{let s=(0,l.useRef)({}),a=(0,l.useRef)({}),i=(0,l.useCallback)((e,r,l)=>{if(s.current[e.id]&&s.current[e.id].readyState===WebSocket.OPEN){a.current[e.id]=r;return}s.current[e.id]&&s.current[e.id].readyState!==WebSocket.CLOSED&&s.current[e.id].close();let n=e.url.replace(/^http/,"ws");console.log("Attempting WebSocket connection to:",n);let o=new WebSocket(n);o.onopen=()=>{let s=t?`${process.env.NEXT_PUBLIC_PAGENAME||"MeoPanel"}_${t.username}`:"unknown",r={uuid:e.uuid,token:e.token,clientName:s};o.send(JSON.stringify(r)),l&&l(o,e)},o.onmessage=t=>{let s=a.current[e.id];s&&s(t,e.id)},o.onerror=t=>{console.error("WebSocket error for server",e.servername,"URL:",n,"Error:",t)},o.onclose=t=>{console.log("WebSocket closed for server",e.servername,"code:",t.code),setTimeout(()=>{i(e,r)},5e3)},s.current[e.id]=o,a.current[e.id]=r},[t]),o=(0,l.useCallback)((e,t)=>{let r=s.current[e];r&&r.readyState===WebSocket.OPEN&&r.send(JSON.stringify(t))},[]),c=(0,l.useCallback)(e=>{let t=s.current[e];t&&(t.close(),delete s.current[e],delete a.current[e])},[]),d=(0,l.useCallback)(e=>{let t=s.current[e];return t&&t.readyState===WebSocket.OPEN},[]);return(0,l.useEffect)(()=>()=>{Object.values(s.current).forEach(e=>{e.readyState===WebSocket.OPEN&&e.close()}),s.current={},a.current={}},[]),r.jsx(n.Provider,{value:{connectToServer:i,sendToServer:o,disconnectFromServer:c,isConnected:d},children:e})},c=(0,l.createContext)(void 0),d=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("usePM2Data must be used within a PM2DataProvider");return e},u=({children:e})=>{let[t,s]=(0,l.useState)({});return r.jsx(c.Provider,{value:{pm2Data:t,updatePM2Data:(e,t)=>{s(s=>({...s,[e]:t}))}},children:e})};var m=s(6153);function x({activeTab:e,user:t}){let{connectToServer:s,sendToServer:a,isConnected:n}=i(),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)({}),[m,x]=(0,l.useState)({}),[p,h]=(0,l.useState)(!1),[g,f]=(0,l.useState)({servername:"",url:"",uuid:"",token:""}),[y,v]=(0,l.useState)(!1);(0,l.useRef)({}),(0,l.useRef)({}),(0,l.useCallback)((t,s)=>{"wserver"===e&&a(s.id,{command:"status",uuid:s.uuid,token:s.token})},[e,a]),(0,l.useCallback)((e,t)=>{try{let s=e.data,r=JSON.parse(s);if(r.pong&&"ok"===r.status){x(e=>({...e,[t]:"online"}));return}if("error"===r.type){console.error("Server error:",r.message),x(e=>({...e,[t]:"offline"}));return}if("status"===r.type&&r.data){let e=r.data;u(s=>({...s,[t]:e})),x(e=>({...e,[t]:"online"}));return}}catch(e){console.error("Failed to parse server message:",e),x(e=>({...e,[t]:"offline"}))}},[]);let b=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch("http://localhost:5000/wservers",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();c(e.data||[])}}catch(e){console.error("Failed to fetch wservers:",e)}},j=async e=>{e.preventDefault(),v(!0);try{let e=localStorage.getItem("accessToken");(await fetch("http://localhost:5000/wservers",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(g)})).ok?(h(!1),f({servername:"",url:"",uuid:"",token:""}),b()):console.error("Failed to add wserver")}catch(e){console.error("Error adding wserver:",e)}finally{v(!1)}},N=async e=>{try{let t=localStorage.getItem("accessToken");(await fetch(`http://localhost:5000/wservers/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok?b():console.error("Failed to delete wserver")}catch(e){console.error("Error deleting wserver:",e)}},w=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB","TB"][t]};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"WServer Management"}),r.jsx("button",{onClick:()=>h(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors",children:"Add WServer"})]}),(0,r.jsxs)("div",{className:"grid gap-6",children:[o.map(e=>{let t=d[e.id],s=m[e.id]||"connecting";return(0,r.jsxs)("div",{className:"bg-gray-800 p-6 rounded-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-white font-medium text-lg",children:e.servername}),(0,r.jsxs)("p",{className:"text-gray-400 text-sm",children:["Server UUID: ",e.id]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[r.jsx("button",{onClick:()=>console.log("Edit",e.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded-md text-sm",children:"Edit"}),r.jsx("button",{onClick:()=>N(e.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-sm",children:"Delete"})]})]}),(0,r.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm ${"offline"===s?"opacity-50":""}`,children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Connection Address:"}),r.jsx("p",{className:"text-white",children:t?.connection_address||"N/A"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Server Status:"}),r.jsx("p",{className:`font-medium ${"online"===s?"text-green-400":"connecting"===s?"text-yellow-400":"text-red-400"}`,children:"connecting"===s?"Connecting...":"online"===s?"Online":"Offline"})]}),t&&t.memory&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Memory:"}),(0,r.jsxs)("p",{className:"text-white",children:["Used: ",w(t.memory.used)," / Total: ",w(t.memory.total)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"CPU:"}),(0,r.jsxs)("p",{className:"text-white",children:[t.cpu.cores," cores, ",t.cpu.usage,"% usage"]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Disk Space:"}),(0,r.jsxs)("p",{className:"text-white",children:["Used: ",w(t.disk_space.used)," / Max: ",w(t.disk_space.max)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Instances Status:"}),(0,r.jsxs)("p",{className:"text-white",children:["Total: ",t.total_instances,", Running: ",t.running_instances,", Stopped: ",t.stopped_instances]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"PM2 Status:"}),(0,r.jsxs)("p",{className:"text-white",children:["Total: ",t.total_pm2,", Running: ",t.running_pm2,", Stopped: ",t.stopped_pm2]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Platform:"}),r.jsx("p",{className:"text-white",children:t.platform})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400",children:"Version:"}),(0,r.jsxs)("p",{className:"text-white",children:["Node: ",t.version.node,", Server: ",t.version.server]})]})]})]})]},e.id)}),0===o.length&&r.jsx("p",{className:"text-gray-400 text-center py-8",children:'No wservers found. Click "Add WServer" to add your first server.'})]}),p&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 p-6 rounded-md w-full max-w-md",children:[r.jsx("h4",{className:"text-white text-lg font-medium mb-4",children:"Add New WServer"}),(0,r.jsxs)("form",{onSubmit:j,children:[(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-gray-300 text-sm mb-2",children:"Server Name"}),r.jsx("input",{type:"text",value:g.servername,onChange:e=>f({...g,servername:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-gray-300 text-sm mb-2",children:"URL"}),r.jsx("input",{type:"url",value:g.url,onChange:e=>f({...g,url:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-gray-300 text-sm mb-2",children:"UUID"}),r.jsx("input",{type:"text",value:g.uuid,onChange:e=>f({...g,uuid:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-gray-300 text-sm mb-2",children:"Token"}),r.jsx("input",{type:"text",value:g.token,onChange:e=>f({...g,token:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 text-gray-300 hover:text-white",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:y,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50",children:y?"Adding...":"Add WServer"})]})]})]})})]})}function p({activeTab:e,user:t}){let{connectToServer:s,sendToServer:a,isConnected:n}=i(),{updatePM2Data:o}=d(),c=e=>{let t=e.split(".").pop()?.toLowerCase();return!!t&&["jpg","jpeg","png","gif","bmp","webp","svg"].includes(t)},u=(e,t)=>e.map(e=>({name:e.name,isDirectory:e.isDirectory,children:[],expanded:!1,path:t?`${t}/${e.name}`:e.name})),m=(e,t=0)=>e.map((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:`flex items-center p-1 rounded cursor-pointer hover:bg-gray-700 text-sm ${D.selectedFiles.has(e.path)?"bg-blue-600 text-white":e.isDirectory?"text-blue-400":"text-gray-300"}`,style:{paddingLeft:`${16*t+4}px`},onClick:t=>{if(e.isDirectory){if(!e.expanded&&0===e.children.length){T(t=>t?{...t,loadingTreePath:e.path}:null);let t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e.path,uuid:t.uuid,token:s})}}T(t=>{if(!t)return t;let s=t=>t.map(t=>t.path===e.path?{...t,expanded:!t.expanded}:t.children?{...t,children:s(t.children)}:t);return{...t,treeData:s(t.treeData)}})}else T(t=>t?{...t,selectedFiles:new Set([e.path])}:null)},onDoubleClick:()=>{if(e.isDirectory){T(t=>t?{...t,currentPath:e.path}:null);let t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e.path,uuid:t.uuid,token:s})}}else{T(t=>{if(!t)return null;let s=t.openFiles.findIndex(t=>t.path===e.path);if(s>=0)return{...t,activeTabIndex:s};{let s=[...t.openFiles,{file:{name:e.name,isDirectory:!1},content:"",path:e.path,originalContent:"",modified:!1}];return{...t,openFiles:s,activeTabIndex:s.length-1}}});let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&a(D.serverId,{command:"pm2-read-file",id:D.process.pm_id,relativePath:e.path,uuid:t.uuid,token:t.token})}},onContextMenu:t=>{t.preventDefault(),T(s=>s?{...s,contextMenu:{x:t.clientX,y:t.clientY,file:{name:e.name,isDirectory:e.isDirectory}}}:null)},onDrop:t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&t.dataTransfer.files.length>0){let s=Array.from(t.dataTransfer.files),r=e.isDirectory?e.path:e.path.includes("/")?e.path.substring(0,e.path.lastIndexOf("/")):"";s.forEach(e=>eb(e,r));return}if(e.isDirectory&&!e.expanded){let s=t.dataTransfer.getData("text/plain");if(s&&s!==e.path){let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&(a(D.serverId,{command:"pm2-move-file",id:D.process.pm_id,sourcePath:s,destinationPath:e.path,uuid:t.uuid,token:t.token}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500))}}},onDragOver:t=>{t.dataTransfer.files&&t.dataTransfer.files.length>0?(t.preventDefault(),t.dataTransfer.dropEffect="copy"):e.isDirectory&&!e.expanded&&(t.preventDefault(),t.dataTransfer.dropEffect="move")},children:[e.isDirectory?r.jsx("span",{className:"mr-1",children:e.expanded?"▼":"▶"}):r.jsx("span",{className:"mr-1",children:"\uD83D\uDCC4"}),r.jsx("span",{children:e.name})]}),e.expanded&&e.children.length>0&&r.jsx("div",{children:m(e.children,t+1)})]},e.path)),[x,p]=(0,l.useState)([]),[h,g]=(0,l.useState)([]),[f,y]=(0,l.useState)({}),[v,b]=(0,l.useState)({}),[j,N]=(0,l.useState)({}),[w,k]=(0,l.useState)(null),[S,P]=(0,l.useState)({}),[I,C]=(0,l.useState)(null),[D,T]=(0,l.useState)(null),[M,F]=(0,l.useState)(null),[$,E]=(0,l.useState)(!0),[A,_]=(0,l.useState)(null),[O,R]=(0,l.useState)({});(0,l.useRef)(null);let W=(0,l.useRef)(null),z=(0,l.useRef)(null),U=(0,l.useRef)(null),[B,L]=(0,l.useState)(!1),[V,q]=(0,l.useState)(0),[J,X]=(0,l.useState)(256),[G,Y]=(0,l.useState)([]),[Z,K]=(0,l.useState)(!0),H=(0,l.useRef)({});(0,l.useCallback)((t,s)=>{if("pm2"===e){if("local"===s.id){let e=localStorage.getItem("accessToken");a(s.id,{uuid:s.uuid,token:e,command:"pm2-list",timestamp:Date.now()})}else a(s.id,{uuid:s.uuid,token:s.token,command:"pm2-list",timestamp:Date.now()});H.current[s.id]=setTimeout(()=>{},0)}},[e,a]),(0,l.useCallback)((e,t)=>{try{let s=e.data,r=JSON.parse(s);if("pm2-list"===r.type){if(y(e=>({...e,[t]:r.data||[]})),b(e=>({...e,[t]:"online"})),r.timestamp){let e=Date.now()-r.timestamp;N(s=>({...s,[t]:e}))}}else if("error"===r.type)console.error("Server error:",r.message),alert(`Error: ${r.message}`);else if("pm2-send"===r.type)console.log("Data sent to process successfully"),_({message:"Data sent to process successfully",type:"success"});else if("pm2-start"===r.type&&"success"===r.status)_({message:"Process started successfully",type:"success"});else if("pm2-stop"===r.type&&"success"===r.status)_({message:"Process stopped successfully",type:"success"});else if("pm2-restart"===r.type&&"success"===r.status)_({message:"Process restarted successfully",type:"success"});else if("pm2-delete"===r.type&&"success"===r.status)_({message:"Process deleted successfully",type:"success"});else if("pm2-save"===r.type&&"success"===r.status)_({message:"Processes saved successfully",type:"success"});else if("pm2-resurrect"===r.type&&"success"===r.status)_({message:"Processes resurrected successfully",type:"success"});else if("pm2-logs"===r.type)C(e=>e?1===e.logs.length&&"Loading logs..."===e.logs[0]?{...e,logs:r.data}:{...e,logs:[...e.logs,...r.data]}:null);else if("pm2-list-files"===r.type)T(e=>{if(!e)return null;if(!e.loadingTreePath)return{...e,files:r.data,treeData:u(r.data,e.currentPath)};{let t=s=>s.map(s=>s.path===e.loadingTreePath?{...s,children:u(r.data,s.path),expanded:!0}:s.children?{...s,children:t(s.children)}:s);return{...e,treeData:t(e.treeData),loadingTreePath:null}}});else if("pm2-read-file"===r.type)T(e=>{if(!e||e.activeTabIndex<0)return e;let t=[...e.openFiles],s=c(t[e.activeTabIndex].file.name)?r.data:atob(r.data);return t[e.activeTabIndex].content=s,t[e.activeTabIndex].originalContent=s,t[e.activeTabIndex].modified=!1,{...e,openFiles:t}});else if("pm2-write-file"===r.type)F("File saved successfully"),setTimeout(()=>{F(null)},3e3);else if("pm2-create-file"===r.type)_({message:"File created successfully",type:"success"});else if("pm2-create-folder"===r.type)_({message:"Folder created successfully",type:"success"});else if("pm2-delete-files"===r.type)_({message:"Files deleted successfully",type:"success"});else if("pm2-rename-file"===r.type)_({message:"File renamed successfully",type:"success"});else if("pm2-move-file"===r.type)_({message:"File moved successfully",type:"success"});else if("pm2-paste-files"===r.type)_({message:"Files pasted successfully",type:"success"});else if("pm2-zip-files"===r.type)_({message:"Files zipped successfully",type:"success"}),T(e=>e?{...e,zippingProgress:null}:null);else if("pm2-zip-progress"===r.type)T(e=>e?{...e,zippingProgress:r.progress}:null);else if("pm2-unzip-file"===r.type)_({message:"File unzipped successfully",type:"success"});else if("pm2-upload-file"===r.type){if(_({message:"File uploaded successfully",type:"success"}),T(e=>e?{...e,uploadProgress:null}:null),D){let e=x.find(e=>e.id===D.serverId);if(e&&n(D.serverId)){let t="local"===D.serverId?localStorage.getItem("accessToken"):e.token;a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:e.uuid,token:t})}}}else if("pm2-download-file"===r.type){let e=document.createElement("a");e.href=`data:application/octet-stream;base64,${r.data.data}`,e.download=r.data.fileName,document.body.appendChild(e),e.click(),document.body.removeChild(e),_({message:"File downloaded successfully",type:"success"})}else b(e=>({...e,[t]:"online"}))}catch(e){console.error("Failed to parse server message:",e),b(e=>({...e,[t]:"offline"}))}},[]);let Q=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB","TB"][t]},ee=e=>{if(!e||e<=0)return"--:--:--";let t=Math.floor(e/1e3);return`${Math.floor(t/3600).toString().padStart(2,"0")}:${Math.floor(t%3600/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`},et=e=>{let t=e.length;return{total:t,running:e.filter(e=>"online"===e.pm2_env.status).length,stopped:e.filter(e=>"stopped"===e.pm2_env.status).length,error:e.filter(e=>"errored"===e.pm2_env.status).length}},es=(e,s,r)=>{if(t&&("ADMIN"===t.role||"OWNER"===t.role))return!0;let a=G.find(t=>t.wserverId===e&&t.pm2ProcessName===s);return!!a&&a.permissions.includes(r)},er=()=>Object.values(S).reduce((e,t)=>e+t.size,0),ea=async(e,t,s)=>{let r=x.find(t=>t.id===e);if(n(e)&&r){let l={command:`pm2-${t}`,uuid:r.uuid,token:r.token};"start"===t?(l.script=s.name,l.name=s.name):l.id=s.pm_id,a(e,l),setTimeout(()=>{n(e)&&a(e,{command:"pm2-list",uuid:r.uuid,token:r.token})},1e3)}},el=async e=>{if(0===er())return;let t={};x.forEach(e=>{let s=S[e.id]||new Set;s.size>0&&(t[e.id]=Array.from(s))}),Object.entries(t).forEach(([t,s])=>{let r=x.find(e=>e.id===t);if(n(t)&&r){let l={command:`pm2-multi-${e}`,uuid:r.uuid,token:r.token};if("start"===e){let e=s.map(e=>{let s=f[t].find(t=>t.name===e);return s?{script:s.name,name:s.name}:null}).filter(Boolean);l.processes=e}else{let e=s.map(e=>{let s=f[t].find(t=>t.name===e);return s?s.pm_id:null}).filter(Boolean);l.ids=e}a(t,l),setTimeout(()=>{n(t)&&a(t,{command:"pm2-list",uuid:r.uuid,token:r.token})},1e3)}}),P({})},en=async(e,t)=>{let s=x.find(t=>t.id===e);if(n(e)&&s){let r=`pm2-${t}`,l="local"===e?localStorage.getItem("accessToken"):s.token;a(e,{command:r,uuid:s.uuid,token:l}),setTimeout(()=>{n(e)&&a(e,{command:"pm2-list",uuid:s.uuid,token:l})},1e3)}},ei=(e,t)=>{let s=f[e]||[],r=[];if("all"===t)r=s;else if("running"===t)r=s.filter(e=>"online"===e.pm2_env.status);else if("stopped"===t)r=s.filter(e=>"stopped"===e.pm2_env.status);else if("error"===t)r=s.filter(e=>"errored"===e.pm2_env.status);else if("unselect"===t){P(t=>({...t,[e]:new Set}));return}P(t=>({...t,[e]:new Set(r.map(e=>e.name))}))},eo=async(e,t)=>{let s=x.find(t=>t.id===e);if(n(e)&&s){C({serverId:e,process:t,logs:["Loading logs..."],command:""}),a(e,{command:"pm2-logs",id:t.pm_id,uuid:s.uuid,token:s.token});let r=!0,l=!1;z.current=(e,t)=>{try{let t=JSON.parse(e.data);"pm2-logs"===t.type&&(l=!0,C(e=>e?r?(r=!1,{...e,logs:t.data}):{...e,logs:[...e.logs,...t.data]}:null))}catch(e){}},setTimeout(()=>{l||C(e=>e&&1===e.logs.length&&"Loading logs..."===e.logs[0]?{...e,logs:["Failed to load logs"]}:e)},5e3)}},ec=async(e,t)=>{let s=x.find(t=>t.id===e);if(n(e)&&s){T({serverId:e,process:t,currentPath:"",files:[],treeData:[],loadingTreePath:null,isTreeView:!0,uploadTargetPath:null,openFiles:[],activeTabIndex:-1,sidebarWidth:256,wordWrap:!0,sidebarVisible:!0,selectedFiles:new Set,clipboard:null,contextMenu:null,isSelecting:!1,selectionStart:null,renamingFile:null,zippingProgress:null,uploadProgress:null});let r="local"===e?localStorage.getItem("accessToken"):s.token;a(e,{command:"pm2-list-files",id:t.pm_id,relativePath:"",uuid:s.uuid,token:r})}},ed=(e,t,s)=>{let r=x.find(t=>t.id===e);n(e)&&r&&s.trim()&&(a(e,{command:"pm2-send",id:t.pm_id,data:s,uuid:r.uuid,token:r.token}),C(e=>e?{...e,command:""}:null))},eu=e=>{if(!D)return;let t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s=D.currentPath?`${D.currentPath}/${e}`:e,r="local"===D.serverId?localStorage.getItem("accessToken"):t.token;a(D.serverId,{command:"pm2-create-file",id:D.process.pm_id,relativePath:s,content:"",uuid:t.uuid,token:r}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500)}},em=e=>{if(!D)return;let t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s=D.currentPath?`${D.currentPath}/${e}`:e,r="local"===D.serverId?localStorage.getItem("accessToken"):t.token;a(D.serverId,{command:"pm2-create-folder",id:D.process.pm_id,relativePath:s,uuid:t.uuid,token:r}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500)}},ex=(e,t)=>{if(!D)return;let s=x.find(e=>e.id===D.serverId);s&&n(D.serverId)&&(a(D.serverId,{command:"pm2-rename-file",id:D.process.pm_id,oldPath:e,newName:t,uuid:s.uuid,token:s.token}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500))},ep=e=>{if(!D)return;let t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;a(D.serverId,{command:"pm2-delete-files",id:D.process.pm_id,filePaths:e,uuid:t.uuid,token:s}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500)}},eh=e=>{if(!D)return;let t=D.files.filter(t=>e.includes(D.currentPath?`${D.currentPath}/${t.name}`:t.name));T(e=>e?{...e,clipboard:{type:"copy",files:t},selectedFiles:new Set}:null)},eg=e=>{if(!D)return;let t=D.files.filter(t=>e.includes(D.currentPath?`${D.currentPath}/${t.name}`:t.name));T(e=>e?{...e,clipboard:{type:"cut",files:t},selectedFiles:new Set}:null)},ef=()=>{if(!D||!D.clipboard)return;let e=x.find(e=>e.id===D.serverId);e&&n(D.serverId)&&(a(D.serverId,{command:"pm2-paste-files",id:D.process.pm_id,clipboard:D.clipboard,destinationPath:D.currentPath,uuid:e.uuid,token:e.token}),"cut"===D.clipboard.type&&T(e=>e?{...e,clipboard:null}:null),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:e.uuid,token:e.token})},500))},ey=(e,t)=>{if(!D)return;let s=x.find(e=>e.id===D.serverId);s&&n(D.serverId)&&(T(e=>e?{...e,zippingProgress:0}:null),a(D.serverId,{command:"pm2-zip-files",id:D.process.pm_id,filePaths:e,zipName:t,uuid:s.uuid,token:s.token}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500))},ev=e=>{if(!D)return;let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&(a(D.serverId,{command:"pm2-unzip-file",id:D.process.pm_id,zipPath:e,destinationPath:D.currentPath,uuid:t.uuid,token:t.token}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500))},eb=(e,t)=>{if(!D)return;let s=t||D.currentPath,r=x.find(e=>e.id===D.serverId);if(r&&n(D.serverId)){T(t=>t?{...t,uploadProgress:{fileName:e.name,progress:0}}:null);let t=new FileReader;t.onprogress=t=>{if(t.lengthComputable){let s=Math.round(t.loaded/t.total*100);T(t=>t?{...t,uploadProgress:{fileName:e.name,progress:s}}:null)}},t.onload=t=>{T(t=>t?{...t,uploadProgress:{fileName:e.name,progress:100}}:null);let l=(t.target?.result).split(",")[1],n="local"===D.serverId?localStorage.getItem("accessToken"):r.token;a(D.serverId,{command:"pm2-upload-file",id:D.process.pm_id,relativePath:s,fileData:l,fileName:e.name,uuid:r.uuid,token:n}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:s,uuid:r.uuid,token:n})},100)},t.readAsDataURL(e)}},ej=e=>{if(!D)return;let t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;a(D.serverId,{command:"pm2-download-file",id:D.process.pm_id,relativePath:e,uuid:t.uuid,token:s})}},eN=e=>{let t={};"all"===e?x.forEach(e=>{let s=f[e.id]||[];t[e.id]=new Set(s.map(e=>e.name))}):"running"===e?x.forEach(e=>{let s=f[e.id]||[];t[e.id]=new Set(s.filter(e=>"online"===e.pm2_env.status).map(e=>e.name))}):"stopped"===e?x.forEach(e=>{let s=f[e.id]||[];t[e.id]=new Set(s.filter(e=>"stopped"===e.pm2_env.status).map(e=>e.name))}):"error"===e?x.forEach(e=>{let s=f[e.id]||[];t[e.id]=new Set(s.filter(e=>"errored"===e.pm2_env.status).map(e=>e.name))}):"unselect"===e&&(t={}),P(t)};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"PM2 Management"}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("span",{className:"text-gray-300 text-sm mr-2",children:"Global Select:"}),(0,r.jsxs)("select",{onChange:e=>eN(e.target.value),className:"bg-gray-700 text-gray-300 text-sm rounded px-2 py-1",children:[r.jsx("option",{value:"",children:"Select..."}),r.jsx("option",{value:"all",children:"All"}),r.jsx("option",{value:"running",children:"Online"}),r.jsx("option",{value:"stopped",children:"Stopped"}),r.jsx("option",{value:"error",children:"Error"}),r.jsx("option",{value:"unselect",children:"Unselect All"})]})]})]}),A&&r.jsx("div",{className:`mb-4 p-3 rounded ${"success"===A.type?"bg-green-600":"bg-red-600"} text-white`,children:A.message}),x.map(e=>{let s=f[e.id]||[],l=t&&("ADMIN"===t.role||"OWNER"===t.role)?s:Z?[]:s.filter(t=>es(e.id,t.name,"view")),i=v[e.id]||"connecting",o=et(l),c=O[e.id]||!1;return(0,r.jsxs)("div",{className:"mb-8 bg-gray-800 rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("button",{onClick:()=>R(t=>({...t,[e.id]:!t[e.id]})),className:"text-white mr-2",children:c?"▶":"▼"}),r.jsx("h4",{className:"text-white font-medium",children:e.servername}),r.jsx("span",{className:`ml-2 text-sm ${"online"===i?"text-green-400":"connecting"===i?"text-yellow-400":"text-red-400"}`,children:"connecting"===i?"Connecting...":"online"===i?"Online":"Offline"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-300",children:[t&&"ADMIN"!==t.role&&"OWNER"!==t.role&&r.jsx("span",{children:"Version: 1.0.0"}),(0,r.jsxs)("span",{children:["Amount: ",o.total]}),(0,r.jsxs)("span",{children:["Run: ",o.running]}),(0,r.jsxs)("span",{children:["Stop: ",o.stopped]}),(0,r.jsxs)("span",{children:["Error: ",o.error]}),(0,r.jsxs)("span",{children:["Ping: ",j[e.id]?`${j[e.id]}ms`:"N/A"]}),(t&&("ADMIN"===t.role||"OWNER"===t.role)||G.some(t=>t.wserverId===e.id))&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>en(e.id,"save"),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700",children:"Save"}),r.jsx("button",{onClick:()=>en(e.id,"resurrect"),className:"px-3 py-1 bg-orange-600 text-white text-sm rounded hover:bg-orange-700",children:"Resurrect"})]})]})]}),!c&&r.jsx(r.Fragment,{children:r.jsx("div",{className:"overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left table-fixed",children:[r.jsx("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"w-12 px-1 py-2 text-xs font-medium text-gray-300 uppercase",children:(0,r.jsxs)("select",{value:"",onChange:t=>ei(e.id,t.target.value),onMouseDown:e=>e.stopPropagation(),onMouseUp:e=>e.stopPropagation(),className:"bg-gray-700 text-gray-300 text-xs rounded px-0.5 py-1 w-full",children:[r.jsx("option",{value:"",children:"☑"}),r.jsx("option",{value:"all",children:"All"}),r.jsx("option",{value:"running",children:"Online"}),r.jsx("option",{value:"stopped",children:"Stopped"}),r.jsx("option",{value:"error",children:"Error"}),r.jsx("option",{value:"unselect",children:"Unselect"})]})}),r.jsx("th",{className:"w-12 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"ID"}),r.jsx("th",{className:"w-32 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Name"}),r.jsx("th",{className:"w-16 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"PID"}),r.jsx("th",{className:"w-20 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Status"}),r.jsx("th",{className:"w-16 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"CPU"}),r.jsx("th",{className:"w-20 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Memory"}),r.jsx("th",{className:"w-20 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Uptime"}),r.jsx("th",{className:"w-12 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"↻"}),r.jsx("th",{className:"w-32 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Note"})]})}),(0,r.jsxs)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:[l.map(t=>(0,r.jsxs)("tr",{className:S[e.id]?.has(t.name)?"bg-gray-700":"",onContextMenu:s=>{s.preventDefault(),k({x:s.clientX,y:s.clientY,process:t,serverId:e.id})},children:[r.jsx("td",{className:"w-12 px-2 py-2 text-white",children:r.jsx("input",{type:"checkbox",checked:S[e.id]?.has(t.name)||!1,onChange:s=>{P(r=>{let a=new Set(r[e.id]||new Set);return s.target.checked?a.add(t.name):a.delete(t.name),{...r,[e.id]:a}})},className:"rounded"})}),r.jsx("td",{className:"w-12 px-4 py-2 text-white",children:t.pm_id}),r.jsx("td",{className:"w-32 px-4 py-2 text-white",children:t.name}),r.jsx("td",{className:"w-16 px-4 py-2 text-white",children:t.pid}),r.jsx("td",{className:"w-20 px-4 py-2 text-white",children:r.jsx("span",{className:`px-2 py-1 rounded text-xs ${"online"===t.pm2_env.status?"bg-green-600 text-white":"stopped"===t.pm2_env.status?"bg-red-600 text-white":"bg-yellow-600 text-white"}`,children:t.pm2_env.status})}),(0,r.jsxs)("td",{className:"w-16 px-4 py-2 text-white",children:[t.monit.cpu.toFixed(1),"%"]}),r.jsx("td",{className:"w-20 px-4 py-2 text-white",children:Q(t.monit.memory)}),r.jsx("td",{className:"w-20 px-4 py-2 text-white",children:"online"===t.pm2_env.status?ee(Date.now()-t.pm2_env.pm_uptime):"N/A"}),r.jsx("td",{className:"w-12 px-4 py-2 text-white",children:t.pm2_env.restart_time}),r.jsx("td",{className:"w-32 px-4 py-2 text-white",children:es(e.id,t.name,"edit_note")?r.jsx("input",{type:"text",value:t.note||"",onChange:s=>{let r=s.target.value;y(s=>({...s,[e.id]:s[e.id].map(e=>e.name===t.name?{...e,note:r}:e)}))},onBlur:()=>{n(e.id)&&a(e.id,{command:"pm2-notes-set",uuid:e.uuid,token:e.token,process_name:t.name,note:t.note||""})},onMouseDown:e=>e.stopPropagation(),onMouseUp:e=>e.stopPropagation(),className:"bg-gray-700 text-white text-xs rounded px-1 py-1 w-full",placeholder:"Add note..."}):r.jsx("span",{className:"text-xs",children:t.note||"N/A"})})]},`${e.id}-${t.pm_id}`)),0===l.length&&r.jsx("tr",{children:r.jsx("td",{colSpan:10,className:"px-4 py-8 text-center text-gray-400",children:Z&&t&&"ADMIN"!==t.role&&"OWNER"!==t.role?"Loading permissions...":"No PM2 processes found or connecting..."})})]})]})})})]},e.id)}),er()>0&&(0,r.jsxs)("div",{className:"mt-8 bg-gray-800 rounded-lg p-4",children:[(0,r.jsxs)("h4",{className:"text-white font-medium mb-4",children:["Selected Processes (",er(),")"]}),r.jsx("div",{className:"mb-4 max-h-32 overflow-y-auto",children:(()=>{let e=[];return x.forEach(t=>{(S[t.id]||new Set).forEach(s=>{e.push({serverName:t.servername,processName:s})})}),e})().map((e,t)=>(0,r.jsxs)("div",{className:"text-gray-300 text-sm",children:[e.serverName," - ",e.processName]},t))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>el("start"),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:"Start Selected"}),r.jsx("button",{onClick:()=>el("stop"),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Stop Selected"}),r.jsx("button",{onClick:()=>el("restart"),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Restart Selected"}),r.jsx("button",{onClick:()=>el("delete"),className:"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700",children:"Delete Selected"}),r.jsx("button",{onClick:()=>P({}),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600",children:"Clear Selection"})]})]}),0===x.length&&r.jsx("p",{className:"text-gray-400 text-center py-8",children:"No servers configured. Add servers in the WServer tab."}),M&&r.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white px-6 py-3 rounded shadow-lg text-center",style:{zIndex:1e4},children:M}),w&&(0,r.jsxs)("div",{className:"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1",style:{left:w.x,top:w.y},children:["online"===w.process.pm2_env.status?r.jsx(r.Fragment,{children:es(w.serverId,w.process.name,"control")&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>{ea(w.serverId,"restart",w.process),k(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Restart"}),r.jsx("button",{onClick:()=>{ea(w.serverId,"stop",w.process),k(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Stop"})]})}):es(w.serverId,w.process.name,"control")&&r.jsx("button",{onClick:()=>{ea(w.serverId,"start",w.process),k(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Start"}),r.jsx("button",{onClick:()=>{eo(w.serverId,w.process),k(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"View Logs"}),es(w.serverId,w.process.name,"control_file")&&r.jsx("button",{onClick:()=>{ec(w.serverId,w.process),k(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"View File"}),es(w.serverId,w.process.name,"control")&&r.jsx("button",{onClick:()=>{ea(w.serverId,"delete",w.process),k(null)},className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:"Delete"})]}),I&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-6xl max-h-3/4 flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-white",children:["Logs for ",I.process.name]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("button",{onClick:()=>eo(I.serverId,I.process),className:"text-gray-400 hover:text-white mr-2",title:"Refresh logs",children:"\uD83D\uDD04"}),r.jsx("button",{onClick:()=>{if(I){let e=x.find(e=>e.id===I.serverId);e&&n(I.serverId)&&(a(I.serverId,{command:"pm2-stop-logs",id:I.process.pm_id,uuid:e.uuid,token:e.token}),z.current=null)}C(null)},className:"text-gray-400 hover:text-white",children:"✕"})]})]}),(0,r.jsxs)("div",{className:"mb-4 bg-gray-700 rounded p-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"Status:"}),r.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${"online"===I.process.pm2_env.status?"bg-green-600 text-white":"stopped"===I.process.pm2_env.status?"bg-red-600 text-white":"bg-yellow-600 text-white"}`,children:I.process.pm2_env.status})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"CPU:"}),(0,r.jsxs)("span",{className:"ml-2 text-white",children:[I.process.monit.cpu.toFixed(1),"%"]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"Memory:"}),r.jsx("span",{className:"ml-2 text-white",children:Q(I.process.monit.memory)})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"Uptime:"}),r.jsx("span",{className:"ml-2 text-white",children:"online"===I.process.pm2_env.status?ee(Date.now()-I.process.pm2_env.pm_uptime):"N/A"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:["online"!==I.process.pm2_env.status&&r.jsx("button",{onClick:()=>ea(I.serverId,"start",I.process),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:"Start"}),"online"===I.process.pm2_env.status&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>ea(I.serverId,"restart",I.process),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Restart"}),r.jsx("button",{onClick:()=>ea(I.serverId,"stop",I.process),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Stop"})]}),r.jsx("button",{onClick:()=>ea(I.serverId,"delete",I.process),className:"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700",children:"Delete"})]})]}),r.jsx("div",{ref:W,onScroll:()=>{if(W.current){let{scrollTop:e,scrollHeight:t,clientHeight:s}=W.current;E(e+s>=t-10)}},className:"flex-1 bg-black rounded p-4 mb-4 overflow-auto max-h-96",children:r.jsx("pre",{className:"text-green-400 text-sm whitespace-pre-wrap",children:I.logs.join("\n")})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",value:I.command,onChange:e=>C(t=>t?{...t,command:e.target.value}:null),onKeyPress:e=>{"Enter"===e.key&&ed(I.serverId,I.process,I.command)},placeholder:"Enter data to send to process (e.g., 5+5)",className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded text-sm"}),r.jsx("button",{onClick:()=>ed(I.serverId,I.process,I.command),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Send"})]})]})}),D&&r.jsx("div",{className:"fixed inset-0 z-50 bg-gray-900 overflow-hidden",children:(0,r.jsxs)("div",{className:"h-full flex flex-col max-h-screen",children:[(0,r.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-1 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("span",{className:"text-gray-400 mr-2",children:"\uD83D\uDCC1"}),r.jsx("span",{className:"text-white font-medium",children:D.process.name}),r.jsx("span",{className:"text-gray-400 mx-2",children:"-"}),(0,r.jsxs)("span",{className:"text-gray-300 text-sm",children:[D.process.pm2_env.pm_cwd,D.currentPath]})]}),(null!==D.zippingProgress||null!==D.uploadProgress)&&(0,r.jsxs)("div",{className:"flex items-center mr-4 space-x-4",children:[null!==D.zippingProgress&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("span",{className:"text-gray-300 text-sm mr-2",children:["Zipping: ",D.zippingProgress,"%"]}),r.jsx("div",{className:"w-32 bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${D.zippingProgress}%`}})})]}),null!==D.uploadProgress&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("span",{className:"text-gray-300 text-sm mr-2",children:["Uploading ",D.uploadProgress.fileName,": ",D.uploadProgress.progress,"%"]}),r.jsx("div",{className:"w-32 bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:`${D.uploadProgress.progress}%`}})})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"file",ref:U,onChange:e=>{let t=e.target.files?.[0];t&&(eb(t,D.uploadTargetPath),T(e=>e?{...e,uploadTargetPath:null}:null),e.target.value="")},style:{display:"none"}}),r.jsx("button",{onClick:()=>U.current?.click(),className:"text-gray-400 hover:text-white p-1",title:"Upload File",children:"⬆"}),r.jsx("button",{onClick:()=>T(e=>e?{...e,isTreeView:!e.isTreeView}:null),className:"text-gray-400 hover:text-white p-1",title:D?.isTreeView?"Switch to List View":"Switch to Tree View",children:D?.isTreeView?"\uD83D\uDCC2":"\uD83D\uDCCB"}),r.jsx("button",{onClick:()=>{D.selectedFiles.size>0&&Array.from(D.selectedFiles).forEach(e=>{ej(e)})},className:"text-gray-400 hover:text-white p-1",title:"Download Selected",disabled:0===D.selectedFiles.size,children:"⬇"}),r.jsx("div",{className:"w-px h-4 bg-gray-600"}),r.jsx("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eu(e)},className:"text-gray-400 hover:text-white p-1",title:"Create File",children:"\uD83D\uDCC4+"}),r.jsx("button",{onClick:()=>{D.selectedFiles.size>0&&eh(Array.from(D.selectedFiles))},className:"text-gray-400 hover:text-white p-1",title:"Copy Selected",disabled:0===D.selectedFiles.size,children:"\uD83D\uDCCB"}),r.jsx("button",{onClick:()=>{D.selectedFiles.size>0&&eg(Array.from(D.selectedFiles))},className:"text-gray-400 hover:text-white p-1",title:"Cut Selected",disabled:0===D.selectedFiles.size,children:"✂"}),r.jsx("button",{onClick:()=>{D.clipboard&&ef()},className:"text-gray-400 hover:text-white p-1",title:"Paste",disabled:!D.clipboard,children:"\uD83D\uDCC4"}),r.jsx("button",{onClick:()=>{if(D.selectedFiles.size>0){let e=prompt("Enter zip file name:","selected_files.zip");e&&ey(Array.from(D.selectedFiles),e)}},className:"text-gray-400 hover:text-white p-1",title:"Zip Selected",disabled:0===D.selectedFiles.size,children:"\uD83D\uDCE6"}),r.jsx("button",{onClick:()=>{D.selectedFiles.size>0&&confirm(`Delete ${D.selectedFiles.size} selected items?`)&&ep(Array.from(D.selectedFiles))},className:"text-gray-400 hover:text-red-400 p-1",title:"Delete Selected",disabled:0===D.selectedFiles.size,children:"\uD83D\uDDD1"}),r.jsx("div",{className:"w-px h-4 bg-gray-600"}),r.jsx("button",{onClick:()=>{let e=x.find(e=>e.id===D.serverId);e&&n(D.serverId)&&a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:e.uuid,token:e.token})},className:"text-gray-400 hover:text-white p-1",title:"Refresh",children:"\uD83D\uDD04"}),r.jsx("button",{onClick:()=>T(null),className:"text-gray-400 hover:text-white p-1",title:"Close",children:"✕"})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[D.sidebarVisible&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-gray-800 border-r border-gray-700 flex flex-col min-h-0",style:{width:D.sidebarWidth},children:[r.jsx("div",{className:"p-3 border-b border-gray-700",children:r.jsx("h3",{className:"text-white font-medium text-sm",children:"EXPLORER"})}),r.jsx("div",{className:"flex-1 overflow-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",style:{scrollbarWidth:"thin",scrollbarColor:"#4B5563 #1F2937",WebkitScrollbarWidth:"thin",WebkitScrollbarTrack:"background: #1F2937",WebkitScrollbarThumb:"background: #4B5563"},children:(0,r.jsxs)("div",{className:"p-2",children:[r.jsx("div",{className:"mb-2 text-xs text-gray-400 cursor-pointer hover:bg-gray-700 p-1 rounded",onContextMenu:e=>{e.preventDefault(),T(t=>t?{...t,contextMenu:{x:e.clientX,y:e.clientY,file:null},selectedFiles:new Set}:null)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.files).forEach(e=>eb(e))},children:D.currentPath?(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("button",{onClick:()=>{let e=D.currentPath.split("/").slice(0,-1).join("/")||"";T(t=>t?{...t,currentPath:e}:null);let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e,uuid:t.uuid,token:t.token})},className:"text-blue-400 hover:text-blue-300 mr-2 px-2 py-1 rounded hover:bg-gray-700 flex items-center",title:"Go back",children:"← .."}),r.jsx("span",{children:"/"}),D.currentPath.split("/").map((e,t)=>(0,r.jsxs)("span",{children:[t>0&&"/",r.jsx("span",{className:"text-gray-300",children:e})]},t))]}):r.jsx("span",{children:"Root"})}),r.jsx("div",{className:"flex-1 space-y-1 select-none bg-gray-800",onMouseDown:e=>{e.target===e.currentTarget&&T(e=>e?{...e,selectedFiles:new Set}:null)},onContextMenu:e=>{e.target===e.currentTarget&&(e.preventDefault(),T(t=>t?{...t,contextMenu:{x:e.clientX,y:e.clientY,file:null},selectedFiles:new Set}:null))},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.files).forEach(e=>eb(e))},children:D.isTreeView?m(D.treeData):D.files.map((e,t)=>{let s=D.currentPath?`${D.currentPath}/${e.name}`:e.name,l=D.selectedFiles.has(s),i=D.renamingFile===s;return(0,r.jsxs)("div",{draggable:!i,onMouseDown:e=>{if(i)return;e.preventDefault();let r=new Set(D.selectedFiles);if(e.ctrlKey||e.metaKey)l?r.delete(s):r.add(s);else if(e.shiftKey&&null!==D.selectionStart){let e=D.selectionStart,s=Math.min(e,t),a=Math.max(e,t);for(let e=s;e<=a;e++){let t=D.files[e],s=D.currentPath?`${D.currentPath}/${t.name}`:t.name;r.add(s)}}else r.clear(),r.add(s),T(e=>e?{...e,selectionStart:t}:null);T(e=>e?{...e,selectedFiles:r,isSelecting:!0}:null)},onMouseEnter:e=>{if(D.isSelecting&&1===e.buttons){let e=new Set(D.selectedFiles),s=D.selectionStart,r=Math.min(s,t),a=Math.max(s,t);e.clear();for(let t=r;t<=a;t++){let s=D.files[t],r=D.currentPath?`${D.currentPath}/${s.name}`:s.name;e.add(r)}T(t=>t?{...t,selectedFiles:e}:null)}},onMouseUp:()=>{T(e=>e?{...e,isSelecting:!1}:null)},onDragStart:e=>{i||(e.dataTransfer.setData("text/plain",s),e.dataTransfer.effectAllowed="move")},onDragOver:t=>{t.dataTransfer.files&&t.dataTransfer.files.length>0?(t.preventDefault(),t.dataTransfer.dropEffect="copy"):e.isDirectory&&!i&&(t.preventDefault(),t.dataTransfer.dropEffect="move")},onDrop:t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&t.dataTransfer.files.length>0){let r=Array.from(t.dataTransfer.files),a=e.isDirectory?s:s.includes("/")?s.substring(0,s.lastIndexOf("/")):"";r.forEach(e=>eb(e,a));return}if(e.isDirectory&&!i){let e=t.dataTransfer.getData("text/plain");if(e&&e!==s){let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&(a(D.serverId,{command:"pm2-move-file",id:D.process.pm_id,sourcePath:e,destinationPath:s,uuid:t.uuid,token:t.token}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500))}}},onDoubleClick:()=>{if(!i){if(e.isDirectory){let t=D.currentPath?`${D.currentPath}/${e.name}`:e.name;T(e=>e?{...e,currentPath:t}:null);let s=x.find(e=>e.id===D.serverId);s&&n(D.serverId)&&a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:t,uuid:s.uuid,token:s.token})}else{T(t=>{if(!t)return null;let r=t.openFiles.findIndex(e=>e.path===s);if(r>=0)return{...t,activeTabIndex:r};{let r=[...t.openFiles,{file:e,content:"",path:s,originalContent:"",modified:!1}];return{...t,openFiles:r,activeTabIndex:r.length-1}}});let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&a(D.serverId,{command:"pm2-read-file",id:D.process.pm_id,relativePath:s,uuid:t.uuid,token:t.token})}}},onContextMenu:t=>{t.preventDefault(),i||T(s=>s?{...s,contextMenu:{x:t.clientX,y:t.clientY,file:e}}:null)},className:`flex items-center p-2 rounded cursor-pointer hover:bg-gray-700 text-sm min-h-[2rem] ${l?"bg-blue-600 text-white":""} ${e.isDirectory?"text-blue-400":"text-gray-300"}`,children:[r.jsx("span",{className:"mr-2",children:e.isDirectory?"\uD83D\uDCC1":"\uD83D\uDCC4"}),i?r.jsx("input",{type:"text",defaultValue:e.name,autoFocus:!0,onKeyDown:t=>{if("Enter"===t.key){let r=t.target.value.trim();r&&r!==e.name&&ex(s,r),T(e=>e?{...e,renamingFile:null}:null)}else"Escape"===t.key&&T(e=>e?{...e,renamingFile:null}:null)},onBlur:t=>{let r=t.target.value.trim();r&&r!==e.name&&ex(s,r),T(e=>e?{...e,renamingFile:null}:null)},className:"flex-1 bg-gray-600 text-white border-none outline-none px-1",onClick:e=>e.stopPropagation()}):r.jsx("span",{className:"truncate",children:e.name})]},t)})})]})})]}),r.jsx("div",{className:"w-1 bg-gray-700 cursor-col-resize hover:bg-gray-600",onMouseDown:e=>{L(!0),q(e.clientX),X(D.sidebarWidth)}})]}),r.jsx("div",{className:"flex-1 flex flex-col bg-gray-900",onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.files).forEach(e=>eb(e))},children:D.openFiles.length>0?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"bg-gray-800 border-b border-gray-700 flex",children:D.openFiles.map((e,t)=>(0,r.jsxs)("div",{className:`flex items-center px-3 py-2 border-r border-gray-700 cursor-pointer hover:bg-gray-700 ${t===D.activeTabIndex?"bg-gray-700":""}`,onClick:()=>T(e=>e?{...e,activeTabIndex:t}:null),children:[r.jsx("span",{className:"text-gray-300 text-sm mr-2",children:e.file.name}),(0,r.jsxs)("div",{className:"flex items-center ml-1",children:[e.modified&&r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-1"}),r.jsx("button",{onClick:e=>{e.stopPropagation(),T(e=>{if(!e)return null;let s=e.openFiles.filter((e,s)=>s!==t),r=e.activeTabIndex;return t===e.activeTabIndex?r=Math.max(0,t-1):t<e.activeTabIndex&&(r=e.activeTabIndex-1),0===s.length&&(r=-1),{...e,openFiles:s,activeTabIndex:r}})},className:"text-gray-500 hover:text-gray-300",children:"✕"})]})]},t))}),!c(D.openFiles[D.activeTabIndex].file.name)&&(0,r.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-0.5 flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("undo")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Undo (Ctrl+Z)",children:"↶"}),r.jsx("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("redo")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Redo (Ctrl+Y)",children:"↷"}),r.jsx("div",{className:"w-px h-4 bg-gray-600"}),r.jsx("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("cut")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Cut (Ctrl+X)",children:"✂"}),r.jsx("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("copy")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Copy (Ctrl+C)",children:"\uD83D\uDCCB"}),r.jsx("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("paste")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Paste (Ctrl+V)",children:"\uD83D\uDCC4"}),r.jsx("button",{onClick:()=>{let e=document.querySelector("textarea");e&&e.select()},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Select All (Ctrl+A)",children:"☑"}),r.jsx("div",{className:"w-px h-4 bg-gray-600"}),r.jsx("button",{onClick:()=>T(e=>e?{...e,wordWrap:!e.wordWrap}:null),className:`px-2 py-1 text-sm rounded ${D.wordWrap?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Toggle Word Wrap",children:"⤶"}),r.jsx("div",{className:"w-px h-4 bg-gray-600"}),r.jsx("button",{onClick:()=>T(e=>e?{...e,sidebarVisible:!e.sidebarVisible}:null),className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Toggle Sidebar",children:"\uD83D\uDCC2"})]}),D.activeTabIndex>=0&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"flex-1 overflow-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",style:{scrollbarWidth:"thin",scrollbarColor:"#4B5563 #1F2937",WebkitScrollbarWidth:"thin",WebkitScrollbarTrack:"background: #1F2937",WebkitScrollbarThumb:"background: #4B5563"},children:c(D.openFiles[D.activeTabIndex].file.name)?r.jsx("div",{className:"flex items-center justify-center h-full p-4",children:r.jsx("img",{src:D.openFiles[D.activeTabIndex].content.startsWith("data:")?D.openFiles[D.activeTabIndex].content:`data:image/${(e=>{switch(e.split(".").pop()?.toLowerCase()){case"jpg":case"jpeg":return"jpeg";case"png":default:return"png";case"gif":return"gif";case"bmp":return"bmp";case"webp":return"webp";case"svg":return"svg+xml"}})(D.openFiles[D.activeTabIndex].file.name)};base64,${D.openFiles[D.activeTabIndex].content}`,className:"max-w-full max-h-full object-contain",alt:D.openFiles[D.activeTabIndex].file.name})}):(0,r.jsxs)("div",{className:"flex",children:[r.jsx("div",{className:"bg-gray-800 border-r border-gray-700 px-1 py-1 text-gray-500 text-sm font-mono select-none flex-shrink-0",children:D.openFiles[D.activeTabIndex].content.split("\n").map((e,t)=>r.jsx("div",{className:"leading-6 h-6",children:t+1},t))}),r.jsx("textarea",{value:D.openFiles[D.activeTabIndex].content,onChange:e=>T(t=>{if(!t||t.activeTabIndex<0)return t;let s=[...t.openFiles];return s[t.activeTabIndex].content=e.target.value,s[t.activeTabIndex].modified=e.target.value!==s[t.activeTabIndex].originalContent,{...t,openFiles:s}}),className:"flex-1 bg-gray-800 text-gray-100 border-0 p-1 font-mono text-sm resize-none focus:outline-none",placeholder:"Loading file content...",spellCheck:!1,style:{lineHeight:"1.5rem",whiteSpace:D.wordWrap?"pre-wrap":"pre"}})]})}),(0,r.jsxs)("div",{className:"bg-gray-800 border-t border-gray-700 px-4 py-1 flex justify-between items-center flex-shrink-0",children:[r.jsx("div",{className:"text-gray-400 text-xs",children:c(D.openFiles[D.activeTabIndex].file.name)?`Image file • ${D.openFiles[D.activeTabIndex].file.name}`:`${D.openFiles[D.activeTabIndex].content.length} characters • ${D.openFiles[D.activeTabIndex].file.name}`}),r.jsx("div",{className:"flex gap-2",children:r.jsx("button",{disabled:c(D.openFiles[D.activeTabIndex].file.name),onClick:()=>{let e=D.openFiles[D.activeTabIndex],t=x.find(e=>e.id===D.serverId);if(t&&n(D.serverId)){let s=c(e.file.name)?e.content:btoa(e.content);a(D.serverId,{command:"pm2-write-file",id:D.process.pm_id,relativePath:e.path,content:s,uuid:t.uuid,token:t.token}),F("File saved successfully"),setTimeout(()=>F(null),3e3),T(e=>{if(!e||e.activeTabIndex<0)return e;let t=[...e.openFiles];return t[e.activeTabIndex].originalContent=t[e.activeTabIndex].content,t[e.activeTabIndex].modified=!1,{...e,openFiles:t}})}},className:`px-4 py-1 text-sm rounded ${c(D.openFiles[D.activeTabIndex].file.name)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:"Save"})})]})]})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[r.jsx("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC4"}),r.jsx("div",{children:"Select a file from the explorer to view its contents"})]})})})]})]})}),D?.contextMenu&&r.jsx("div",{className:"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 min-w-[160px]",style:{left:Math.min(D.contextMenu.x,window.innerWidth-180),top:Math.min(D.contextMenu.y,window.innerHeight-200)},children:D.contextMenu.file?(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eu(e),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),r.jsx("button",{onClick:()=>{let e=prompt("Enter folder name:");e&&em(e),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),r.jsx("button",{onClick:()=>{let e=D.contextMenu.file.isDirectory?D.contextMenu.file.path:D.contextMenu.file.path.split("/").slice(0,-1).join("/")||"";T(t=>t?{...t,uploadTargetPath:e,contextMenu:null}:null),U.current?.click()},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Upload File"}),r.jsx("div",{className:"border-t border-gray-600 my-1"}),D.contextMenu.file.isDirectory?(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name;T(t=>t?{...t,currentPath:e,contextMenu:null}:null);let t=x.find(e=>e.id===D.serverId);t&&n(D.serverId)&&a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e,uuid:t.uuid,token:t.token})},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Open"}),r.jsx("div",{className:"border-t border-gray-600 my-1"}),r.jsx("button",{onClick:()=>{let e=prompt("Enter file name:");if(e){let t=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}/${e}`:`${D.contextMenu.file.name}/${e}`,s=x.find(e=>e.id===D.serverId);if(s&&n(D.serverId)){let e="local"===D.serverId?localStorage.getItem("accessToken"):s.token;a(D.serverId,{command:"pm2-create-file",id:D.process.pm_id,relativePath:t,content:"",uuid:s.uuid,token:e}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500)}}T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),r.jsx("button",{onClick:()=>{let e=prompt("Enter folder name:");if(e){let t=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}/${e}`:`${D.contextMenu.file.name}/${e}`,s=x.find(e=>e.id===D.serverId);if(s&&n(D.serverId)){let e="local"===D.serverId?localStorage.getItem("accessToken"):s.token;a(D.serverId,{command:"pm2-create-folder",id:D.process.pm_id,relativePath:t,uuid:s.uuid,token:e}),setTimeout(()=>{a(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500)}}T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),r.jsx("div",{className:"border-t border-gray-600 my-1"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name;T(t=>t?{...t,contextMenu:null,renamingFile:e}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Rename"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name;T(t=>t?{...t,contextMenu:null,renamingFile:e}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Rename"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name,t=prompt("Enter zip file name:",`${D.contextMenu.file.name}.zip`);t&&ey([e],t),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Zip Folder"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name;confirm(`Delete folder ${D.contextMenu.file.name} and all its contents?`)&&ep([e]),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:"Delete"})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eu(e),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),r.jsx("button",{onClick:()=>{let e=prompt("Enter folder name:");e&&em(e),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),r.jsx("div",{className:"border-t border-gray-600 my-1"}),r.jsx("button",{onClick:()=>{eh([D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name]),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Copy"}),r.jsx("button",{onClick:()=>{eg([D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name]),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Cut"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name;T(t=>t?{...t,contextMenu:null,renamingFile:e}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Rename"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name;confirm(`Delete ${D.contextMenu.file.name}?`)&&ep([e]),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:"Delete"}),r.jsx("button",{onClick:()=>{let e=D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name,t=prompt("Enter zip file name:",`${D.contextMenu.file.name}.zip`);t&&ey([e],t),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Zip"}),D.contextMenu.file.name.endsWith(".zip")&&r.jsx("button",{onClick:()=>{ev(D.currentPath?`${D.currentPath}/${D.contextMenu.file.name}`:D.contextMenu.file.name),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Unzip"})]})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eu(e),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),r.jsx("button",{onClick:()=>{let e=prompt("Enter folder name:");e&&em(e),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),r.jsx("button",{onClick:()=>{T(e=>e?{...e,uploadTargetPath:"",contextMenu:null}:null),U.current?.click()},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Upload File"}),D.clipboard&&r.jsx("button",{onClick:()=>{ef(),T(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Paste"})]})}),M&&r.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white px-6 py-3 rounded shadow-lg text-center",style:{zIndex:1e4},children:M})]})}function h({activeTab:e}){return(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Instance Management"}),r.jsx("p",{className:"text-gray-400",children:"Instance management features coming soon..."})]})}function g({activeTab:e}){let{user:t}=(0,a.a)(),[s,n]=(0,l.useState)([]),[i,o]=(0,l.useState)(!0),[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)({name:"",role:"",status:0}),x=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch("http://localhost:5000/users",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok){let e=await t.json();n(e.data)}}catch(e){console.error("Failed to fetch users:",e)}finally{o(!1)}},p=e=>!!t&&t.id!==e.id&&("OWNER"===t.role||"ADMIN"===t.role&&"MEMBER"===e.role),h=e=>!!t&&t.id!==e.id&&("OWNER"===t.role||"ADMIN"===t.role&&"MEMBER"===e.role),g=e=>{p(e)&&(d(e.id),m({name:e.name||"",role:e.role,status:e.status}))},f=()=>{d(null),m({name:"",role:"",status:0})},y=async e=>{try{let t=localStorage.getItem("accessToken"),s=await fetch(`http://localhost:5000/users/${e.id}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:u.name})});h(e)&&u.role!==e.role&&await fetch(`http://localhost:5000/users/${e.id}/role`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({role:u.role})}),u.status!==e.status&&await fetch(`http://localhost:5000/users/${e.id}/status`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({status:u.status})}),s.ok&&(x(),f())}catch(e){console.error("Failed to update user:",e)}};return i?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h3",{className:"text-2xl font-bold text-white",children:"User Manager"}),r.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[r.jsx("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Name"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Username"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Email"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Role"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Created"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:s.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:c===e.id?r.jsx("input",{type:"text",value:u.name,onChange:e=>m({...u,name:e.target.value}),className:"bg-gray-700 text-white px-2 py-1 rounded"}):e.name||"N/A"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.username}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.email}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:c===e.id&&h(e)?(0,r.jsxs)("select",{value:u.role,onChange:e=>m({...u,role:e.target.value}),className:"bg-gray-700 text-white px-2 py-1 rounded",children:[r.jsx("option",{value:"MEMBER",children:"Member"}),r.jsx("option",{value:"ADMIN",children:"Admin"}),t?.role==="OWNER"&&r.jsx("option",{value:"OWNER",children:"Owner"})]}):e.role}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:c===e.id?(0,r.jsxs)("select",{value:u.status,onChange:e=>m({...u,status:parseInt(e.target.value)}),className:"bg-gray-700 text-white px-2 py-1 rounded",children:[r.jsx("option",{value:-1,children:"Banned"}),r.jsx("option",{value:0,children:"Inactive"}),r.jsx("option",{value:1,children:"Active"})]}):-1===e.status?"Banned":0===e.status?"Inactive":"Active"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-300",children:new Date(e.created_at).toLocaleDateString()}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:c===e.id?(0,r.jsxs)("div",{className:"space-x-2",children:[r.jsx("button",{onClick:()=>y(e),className:"text-green-400 hover:text-green-300",children:"Save"}),r.jsx("button",{onClick:f,className:"text-red-400 hover:text-red-300",children:"Cancel"})]}):p(e)&&r.jsx("button",{onClick:()=>g(e),className:"text-blue-400 hover:text-blue-300",children:"Edit"})})]},e.id))})]})})]})}let f="http://localhost:5000",y=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch(`${f}/users`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok)return(await t.json()).data;throw Error("Failed to fetch users")},v=async()=>{let e={id:"local",servername:"Local Server",url:"ws://localhost:5000",uuid:"local-server",token:"local-token",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{let t=localStorage.getItem("accessToken"),s=await fetch(`${f}/wservers`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)return[e];{let t=(await s.json()).data||[];return[e,...t]}}catch(t){return console.error("Failed to fetch wservers:",t),[e]}},b=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch(`${f}/pm2-permissions`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok)return await t.json();throw Error("Failed to fetch permissions")},j=async e=>{let t=localStorage.getItem("accessToken"),s=await fetch(`${f}/pm2-permissions/user/${e}`,{headers:{Authorization:`Bearer ${t}`}});if(s.ok)return await s.json();throw Error("Failed to fetch my permissions")},N=async(e,t)=>{let s=localStorage.getItem("accessToken"),r=await fetch(`${f}/pm2-permissions/user/${e}/server/${t}`,{headers:{Authorization:`Bearer ${s}`}});if(r.ok)return await r.json();throw Error("Failed to fetch current permissions")},w=async(e,t,s,r)=>{let a=localStorage.getItem("accessToken");if(!(await fetch(`${f}/pm2-permissions/upsert`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({userId:e,wserverId:t,pm2ProcessName:s,permissions:r})})).ok)throw Error("Failed to save permissions")},k=async e=>{let t=localStorage.getItem("accessToken");if(!(await fetch(`${f}/pm2-permissions/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw Error("Failed to delete permission")},S=[{value:"view",label:"View PM2 Process"},{value:"control",label:"Control (Start/Stop/Restart/Send)"},{value:"edit_note",label:"Edit Notes"},{value:"control_file",label:"Control Files"},{value:"save_resurrect",label:"Save/Resurrect"}],P=e=>{let[t,s]=(0,l.useState)([]),[r,a]=(0,l.useState)([]),[n,i]=(0,l.useState)([]),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(!0),[m,x]=(0,l.useState)(""),[p,h]=(0,l.useState)(""),[g,f]=(0,l.useState)([]),[P,I]=(0,l.useState)([]),[C,D]=(0,l.useState)(!1),[T,M]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let[e,t,r]=await Promise.all([y(),v(),b()]);s(e),a(t.filter(e=>"Local Server"!==e.servername)),i(r)}catch(e){console.error("Failed to load initial data:",e)}finally{u(!1)}})()},[]),(0,l.useEffect)(()=>{e&&j(e.id).then(c).catch(e=>console.error("Failed to fetch my permissions:",e))},[e]),(0,l.useEffect)(()=>{m&&p&&g.length>0?N(m,p).then(e=>{let t=e.filter(e=>g.includes(e.pm2ProcessName));0===t.length?I([]):1===t.length?I(t[0].permissions):I(t[0].permissions.filter(e=>t.every(t=>t.permissions.includes(e))))}).catch(e=>{console.error("Failed to fetch current permissions:",e),I([])}):I([])},[m,p,g]),(0,l.useEffect)(()=>{if(T){let e=setTimeout(()=>M(null),3e3);return()=>clearTimeout(e)}},[T]);let F=async()=>{if(m&&p&&0!==g.length){D(!0);try{let e=g.map(e=>w(m,p,e,P));await Promise.all(e);let t=await b();i(t),M({message:`Permissions saved for ${g.length} process(es)`,type:"success"})}catch(e){console.error("Failed to save permissions:",e),M({message:"Failed to save permissions",type:"error"})}finally{D(!1)}}};return{users:t,wservers:r,permissions:n,myPermissions:o,permissionOptions:S,loading:d,selectedUser:m,selectedServer:p,selectedProcesses:g,currentPermissions:P,saving:C,toast:T,setSelectedUser:x,setSelectedServer:h,setSelectedProcesses:f,togglePermission:e=>{I(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleSavePermissions:F,handleDeletePermission:async e=>{if(confirm("Are you sure you want to delete this permission?"))try{await k(e);let t=await b();i(t)}catch(e){console.error("Failed to delete permission:",e),alert("Failed to delete permission")}},selectAllProcesses:e=>{g.length===e.length?f([]):f(e.map(e=>e.name))},selectAllPermissions:()=>{P.length===S.length?I([]):I(S.map(e=>e.value))}}};function I({myPermissions:e,permissionOptions:t}){return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[r.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"My PM2 Permissions"}),0===e.length?r.jsx("p",{className:"text-gray-400",children:"You don't have any PM2 permissions assigned yet."}):r.jsx("div",{className:"space-y-4",children:e.map(e=>(0,r.jsxs)("div",{className:"bg-gray-700 rounded p-4",children:[r.jsx("div",{className:"flex justify-between items-start mb-2",children:(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-white font-medium",children:e.pm2ProcessName}),(0,r.jsxs)("p",{className:"text-gray-400 text-sm",children:["Server: ",e.wserver?.servername||e.wserverId]})]})}),r.jsx("div",{className:"flex flex-wrap gap-2",children:e.permissions.map(e=>r.jsx("span",{className:"px-2 py-1 bg-blue-600 text-xs rounded",children:t.find(t=>t.value===e)?.label||e},e))})]},e.id))})]})}function C({users:e,wservers:t,pm2Processes:s,permissionOptions:a,selectedUser:l,selectedServer:n,selectedProcesses:i,currentPermissions:o,saving:c,fetchingProcesses:d,onUserChange:u,onServerChange:m,onProcessToggle:x,onSelectAllProcesses:p,onPermissionToggle:h,onSelectAllPermissions:g,onSave:f}){return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[r.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Set Permissions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User"}),(0,r.jsxs)("select",{value:l,onChange:e=>u(e.target.value),className:"w-full bg-gray-700 text-white px-3 py-2 rounded",children:[r.jsx("option",{value:"",children:"Select User"}),e.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.username," (",e.email,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server"}),(0,r.jsxs)("select",{value:n,onChange:e=>m(e.target.value),className:"w-full bg-gray-700 text-white px-3 py-2 rounded",children:[r.jsx("option",{value:"",children:"Select Server"}),t.map(e=>r.jsx("option",{value:e.id,children:e.servername},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["PM2 Processes",s.length>0&&r.jsx("button",{onClick:p,className:"ml-2 text-xs text-blue-400 hover:text-blue-300",children:i.length===s.length?"Unselect All":"Select All"})]}),r.jsx("div",{className:"max-h-32 overflow-y-auto bg-gray-700 rounded p-2",children:d?r.jsx("div",{className:"text-gray-400 text-sm",children:"Loading processes..."}):0===s.length?r.jsx("div",{className:"text-gray-400 text-sm",children:"No processes found"}):s.map(e=>(0,r.jsxs)("label",{className:"flex items-center mb-1",children:[r.jsx("input",{type:"checkbox",checked:i.includes(e.name),onChange:()=>x(e.name),className:"mr-2"}),r.jsx("span",{className:"text-white text-sm",children:e.name})]},e.name))})]})]}),l&&n&&i.length>0&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Permissions"}),r.jsx("button",{onClick:g,className:"text-xs text-blue-400 hover:text-blue-300",children:o.length===a.length?"Unselect All":"Select All"})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:a.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:o.includes(e.value),onChange:()=>h(e.value),className:"mr-2"}),r.jsx("span",{className:"text-white",children:e.label})]},e.value))})]}),r.jsx("button",{onClick:f,disabled:c||!l||!n||0===i.length,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:c?"Saving...":"Save Permissions"})]})}function D({permissions:e,permissionOptions:t,onDeletePermission:s}){return r.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[r.jsx("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Server"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Process"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Permissions"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsxs)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:[e.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.user?.username||e.userId}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.wserver?.servername||e.wserverId}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.pm2ProcessName}),r.jsx("td",{className:"px-6 py-4 text-white",children:r.jsx("div",{className:"flex flex-wrap gap-1",children:e.permissions.map(e=>r.jsx("span",{className:"px-2 py-1 bg-blue-600 text-xs rounded",children:t.find(t=>t.value===e)?.label||e},e))})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsx("button",{onClick:()=>s(e.id),className:"text-red-400 hover:text-red-300",children:"Delete"})})]},e.id)),0===e.length&&r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-400",children:"No permissions configured"})})]})]})})}function T({toast:e}){return e?r.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:r.jsx("div",{className:`px-4 py-2 rounded shadow-lg text-white ${"success"===e.type?"bg-green-600":"bg-red-600"}`,children:e.message})}):null}function M({activeTab:e}){let{user:t}=(0,a.a)(),{connectToServer:s,sendToServer:n,isConnected:o}=i(),[c,d]=(0,l.useState)([]),[u,m]=(0,l.useState)(!1),x=(0,l.useRef)(null),p=(0,l.useRef)(0),{users:h,wservers:g,permissions:f,myPermissions:y,permissionOptions:v,loading:b,selectedUser:j,selectedServer:N,selectedProcesses:w,currentPermissions:k,saving:S,toast:M,setSelectedUser:F,setSelectedServer:$,setSelectedProcesses:E,togglePermission:A,handleSavePermissions:_,handleDeletePermission:O,selectAllProcesses:R,selectAllPermissions:W}=P(t);return((0,l.useCallback)((e,t)=>{try{let s=JSON.parse(e.data);"pm2-getlist"===s.type&&t===N&&(d(s.data||[]),m(!1),x.current=N,p.current=Date.now())}catch(e){console.error("Failed to parse WebSocket message:",e),m(!1)}},[N]),b)?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h3",{className:"text-2xl font-bold text-white",children:"User PM2 Permissions"}),t&&"MEMBER"===t.role&&r.jsx(I,{myPermissions:y,permissionOptions:v}),(t?.role==="ADMIN"||t?.role==="OWNER")&&r.jsx(C,{users:h,wservers:g,pm2Processes:c,permissionOptions:v,selectedUser:j,selectedServer:N,selectedProcesses:w,currentPermissions:k,saving:S,fetchingProcesses:u,onUserChange:F,onServerChange:$,onProcessToggle:e=>{E(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onSelectAllProcesses:()=>R(c),onPermissionToggle:A,onSelectAllPermissions:W,onSave:_}),(t?.role==="ADMIN"||t?.role==="OWNER")&&r.jsx(D,{permissions:f,permissionOptions:v,onDeletePermission:O}),r.jsx(T,{toast:M})]})}let F=async(e,t,s)=>{let r=localStorage.getItem("accessToken"),a=new URLSearchParams({limit:t.toString(),offset:((e-1)*t).toString()});s.username&&a.append("username",s.username),s.resource&&a.append("resource",s.resource),s.startDate&&a.append("startDate",s.startDate+"T00:00:00.000Z"),s.endDate&&a.append("endDate",s.endDate+"T23:59:59.999Z");let l=await fetch(`http://localhost:5000/audit/logs?${a}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(l.ok)return await l.json();throw Error("Failed to fetch audit logs")},$=()=>{let[e,t]=(0,l.useState)([]),[s,r]=(0,l.useState)(!0),[a,n]=(0,l.useState)(1),[i,o]=(0,l.useState)(1),[c,d]=(0,l.useState)(0),[u,m]=(0,l.useState)({username:"",resource:"",startDate:"",endDate:""});return(0,l.useEffect)(()=>{let e=new Date,t=new Date(e.getTime()-6048e5).toISOString().split("T")[0],s=e.toISOString().split("T")[0];m(e=>({...e,startDate:t,endDate:s}))},[]),(0,l.useEffect)(()=>{(async()=>{try{r(!0);let e=await F(a,20,u);t(e.logs),d(e.total),o(e.totalPages)}catch(e){console.error("Failed to fetch audit logs:",e)}finally{r(!1)}})()},[a,u]),{logs:e,loading:s,currentPage:a,totalPages:i,total:c,filters:u,handleFilterChange:e=>{m(e),n(1)},handlePageChange:e=>{n(e)},resetPage:()=>{n(1)}}};function E({filters:e,tempFilters:t,onTempFiltersChange:s,onApplyFilters:a}){return r.jsx("div",{className:"bg-gray-800 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),r.jsx("input",{type:"text",value:t.username,onChange:e=>s({...t,username:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter username"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Resource"}),(0,r.jsxs)("select",{value:t.resource,onChange:e=>s({...t,resource:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"All Resources"}),r.jsx("option",{value:"USER",children:"User"}),r.jsx("option",{value:"AUTH",children:"Auth"}),r.jsx("option",{value:"SESSION",children:"Session"}),r.jsx("option",{value:"PASSWORD",children:"Password"}),r.jsx("option",{value:"EMAIL",children:"Email"}),r.jsx("option",{value:"TWO_FA",children:"Two FA"}),r.jsx("option",{value:"SYSTEM",children:"System"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Start Date"}),r.jsx("input",{type:"date",value:t.startDate,onChange:e=>s({...t,startDate:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"End Date"}),r.jsx("input",{type:"date",value:t.endDate,onChange:e=>s({...t,endDate:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsx("div",{className:"flex items-end",children:r.jsx("button",{onClick:a,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Filter"})})]})})}function A({logs:e,onRowDoubleClick:t}){return r.jsx("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[r.jsx("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Time"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Action"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Resource"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Details"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"IP"}),r.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Success"})]})}),r.jsx("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:e.map(e=>(0,r.jsxs)("tr",{onDoubleClick:()=>t(e),className:"cursor-pointer hover:bg-gray-700 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-300",children:new Date(e.createdAt).toLocaleString()}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.user?e.user.username:"System"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.action}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.resource}),r.jsx("td",{className:"px-6 py-4 text-white max-w-xs truncate",children:e.details}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-300",children:e.ipAddress||"N/A"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${e.isSuccess?"bg-green-800 text-green-200":"bg-red-800 text-red-200"}`,children:e.isSuccess?"Success":"Failed"})})]},e.id))})]})})}function _({currentPage:e,totalPages:t,total:s,logsCount:a,onPageChange:l}){return(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"text-gray-300",children:["Showing ",a>0?(e-1)*20+1:0," to ",Math.min(20*e,s)," of ",s," entries"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:()=>l(e-1),disabled:1===e,className:"px-4 py-2 bg-gray-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600",children:"Previous"}),(0,r.jsxs)("span",{className:"text-white",children:["Page ",e," of ",t]}),r.jsx("button",{onClick:()=>l(e+1),disabled:e>=t,className:"px-4 py-2 bg-gray-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600",children:"Next"})]})]})}function O({selectedLog:e,isOpen:t,onClose:s}){return t&&e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"text-xl font-bold text-white",children:"Audit Log Details"}),r.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-2xl",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Log ID"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:e.id})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Created At"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:new Date(e.createdAt).toLocaleString()})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"User"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:e.user?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Username:"})," ",e.user.username]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Name:"})," ",e.user.name]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Email:"})," ",e.user.email]})]}):"System"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Action & Resource"}),(0,r.jsxs)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:[(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Action:"})," ",e.action]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Resource:"})," ",e.resource]}),(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Success:"})," ",e.isSuccess?"Yes":"No"]})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Details"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md whitespace-pre-wrap",children:e.details})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"IP Address"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:e.ipAddress||"N/A"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"User Agent"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md text-sm",children:e.userAgent||"N/A"})]})]}),e.sessionId&&(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Session ID"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md font-mono text-sm",children:e.sessionId})]}),e.metadata&&Object.keys(e.metadata).length>0&&(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Metadata"}),r.jsx("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:r.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(e.metadata,null,2)})})]})]}),r.jsx("div",{className:"flex justify-end mt-6",children:r.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Close"})})]})}):null}function R({activeTab:e}){let{logs:t,loading:s,currentPage:a,totalPages:n,total:i,filters:o,handleFilterChange:c,handlePageChange:d,resetPage:u}=$(),[m,x]=(0,l.useState)(null),[p,h]=(0,l.useState)(!1),[g,f]=(0,l.useState)({username:"",resource:"",startDate:"",endDate:""});return s?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h3",{className:"text-2xl font-bold text-white",children:"Admin Log"}),r.jsx(E,{filters:o,tempFilters:g,onTempFiltersChange:f,onApplyFilters:()=>{c(g),u()}}),r.jsx(A,{logs:t,onRowDoubleClick:e=>{x(e),h(!0)}}),r.jsx(_,{currentPage:a,totalPages:n,total:i,logsCount:t.length,onPageChange:d}),r.jsx(O,{selectedLog:m,isOpen:p,onClose:()=>{h(!1),x(null)}})]})}var W=s(2862);let z="force-dynamic";function U(){let{user:e,logout:t,isLoading:s}=(0,a.a)(),[n,i]=(0,l.useState)("pm2");(0,m.useRouter)();let c=e=>{i(e),localStorage.setItem("activeTab",e)};return s?r.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):e?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[r.jsx(W.Z,{user:e,logout:t}),r.jsx("main",{className:"flex-1",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[r.jsx("h2",{className:"text-3xl font-bold text-white mb-8",children:"Dashboard"}),r.jsx("div",{className:"mb-8",children:r.jsx("div",{className:"border-b border-gray-700",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("button",{onClick:()=>c("wserver"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"wserver"===n?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"}`,children:"WServer"}),r.jsx("button",{onClick:()=>c("pm2"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"pm2"===n?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"}`,children:"PM2"}),r.jsx("button",{onClick:()=>c("instance"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"instance"===n?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"}`,children:"Instance"}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("button",{onClick:()=>c("usermanager"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"usermanager"===n?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"}`,children:"User Manager"}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("button",{onClick:()=>c("userpermissions"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"userpermissions"===n?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"}`,children:"User Permissions"}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("button",{onClick:()=>c("adminlog"),className:`py-2 px-1 border-b-2 font-medium text-sm ${"adminlog"===n?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"}`,children:"Admin Log"})]})})}),r.jsx(u,{children:r.jsx(o,{user:e,children:(0,r.jsxs)("div",{className:"tab-content",children:[e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("div",{className:"wserver"===n?"":"hidden",children:r.jsx(x,{activeTab:n,user:e})}),r.jsx("div",{className:"pm2"===n?"":"hidden",children:r.jsx(p,{activeTab:n,user:e})}),r.jsx("div",{className:"instance"===n?"":"hidden",children:r.jsx(h,{activeTab:n})}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("div",{className:"usermanager"===n?"":"hidden",children:r.jsx(g,{activeTab:n})}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("div",{className:"userpermissions"===n?"":"hidden",children:r.jsx(M,{activeTab:n})}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&r.jsx("div",{className:"adminlog"===n?"":"hidden",children:r.jsx(R,{activeTab:n})})]})})})]})}),r.jsx("footer",{className:"bg-gray-800 border-t border-gray-700",children:r.jsx("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:r.jsx("div",{className:"text-center text-gray-400",children:r.jsx("p",{children:"\xa9 2024 MeoPanel Client. All rights reserved."})})})})]}):null}},8652:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,dynamic:()=>a});var r=s(2772);let a=(0,r.createProxy)(String.raw`d:\PDev\MeoPanel\MeoPanel-Client\front-end\src\app\dashboard\page.tsx#dynamic`),l=(0,r.createProxy)(String.raw`d:\PDev\MeoPanel\MeoPanel-Client\front-end\src\app\dashboard\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[319,254],()=>s(1004));module.exports=r})();