(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[476],{1343:function(e,t,a){Promise.resolve().then(a.bind(a,5806))},5806:function(e,t,a){"use strict";a.d(t,{default:function(){return i}});var o=a(7821),r=a(8504),n=a(8078),s=a(9926);function i(){let e=(0,r.useSearchParams)(),t=(0,r.useRouter)(),{verifyEmail:a}=(0,s.a)(),i=e.get("token"),[c,l]=(0,n.useState)("loading"),[u,h]=(0,n.useState)("");return((0,n.useEffect)(()=>{if(!i){t.push("/");return}(async()=>{try{await a(i),l("success"),h("Email verified successfully! Redirecting..."),t.push("/")}catch(e){l("error"),h(e.message||"Email verification failed. The token may be invalid or expired.")}})()},[i,t,a]),i)?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,o.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,o.jsx)("div",{children:(0,o.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Email Verification"})}),(0,o.jsxs)("div",{className:"mt-8 space-y-6",children:["loading"===c&&(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,o.jsx)("p",{className:"mt-4 text-gray-600",children:"Verifying your email..."})]}),"success"===c&&(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,o.jsx)("p",{className:"mt-4 text-green-600",children:u})]}),"error"===c&&(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,o.jsx)("p",{className:"mt-4 text-red-600",children:u}),(0,o.jsx)("button",{onClick:()=>t.push("/"),className:"mt-4 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Go to Home"})]})]})]})}):null}},9926:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return i},a:function(){return c}});var o=a(7821),r=a(8078);let n="http://".concat("192.168.100.193",":").concat("5000"),s=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[c,l]=(0,r.useState)(!0),[u,h]=(0,r.useState)(!1),[d,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=setTimeout(()=>{m()},500),t=setTimeout(()=>{l(!1)},1e4);return()=>{clearTimeout(e),clearTimeout(t)}},[]);let m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{let t=localStorage.getItem("accessToken");if(t){let a=await fetch("".concat(n,"/auth/me"),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();i(e),l(!1)}else if(401===a.status)await g(),l(!1);else if(a.status>=500&&e<3){setTimeout(()=>m(e+1),1e3*(e+1));return}else l(!1)}else l(!1)}catch(t){if(console.error("Auth check failed:",t),e<3){setTimeout(()=>m(e+1),1e3*(e+1));return}l(!1)}},g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{let t=localStorage.getItem("refreshToken");if(!t){l(!1);return}let a=await fetch("".concat(n,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(a.ok){let e=await a.json();localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken);let t=await fetch("".concat(n,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e.accessToken),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();i(e)}l(!1)}else if(a.status>=500&&e<3){setTimeout(()=>g(e+1),1e3*(e+1));return}else w(),l(!1)}catch(t){if(console.error("Token refresh failed:",t),e<3){setTimeout(()=>g(e+1),1e3*(e+1));return}w(),l(!1)}},p=async(e,t,a)=>{let o=await fetch("".concat(n,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernameOrEmail:e,password:t,twoFactorCode:a})}),r=await o.json();if(!o.ok)throw Error(r.message||"Login failed");return r.requiresTwoFactor?(localStorage.setItem("tempLogin",JSON.stringify({email:e,password:t})),h(!0),f(r.userId)):(localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("refreshToken",r.refreshToken),i(r.user),h(!1),f(null)),r},y=async e=>{let t=await fetch("".concat(n,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.message||"Registration failed");return a},w=async()=>{try{{let e=localStorage.getItem("refreshToken");e&&await fetch("".concat(n,"/auth/logout"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})})}}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null),h(!1),f(null)}},T=async()=>{try{{let e=localStorage.getItem("accessToken");await fetch("".concat(n,"/auth/logout-all"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})}}catch(e){console.error("Logout all error:",e)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),i(null),h(!1),f(null)}},S=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("".concat(n,"/auth/sessions"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),a=await t.json();if(!t.ok)throw Error(a.message||"Get sessions failed");return a},j=async e=>{let t=localStorage.getItem("accessToken"),a=await fetch("".concat(n,"/auth/logout-session"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({sessionId:e})}),o=await a.json();if(!a.ok)throw Error(o.message||"Logout session failed");return o},k=async e=>{let t=await fetch("".concat(n,"/auth/forgot-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await t.json();if(!t.ok)throw Error(a.message||"Forgot password failed");return a},x=async(e,t,a)=>{let o=await fetch("".concat(n,"/auth/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,newPassword:t,confirmNewPassword:a})}),r=await o.json();if(!o.ok)throw Error(r.message||"Reset password failed");return r},v=async(e,t)=>{let a=localStorage.getItem("accessToken"),o=await fetch("".concat(n,"/auth/change-password"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),r=await o.json();if(!o.ok)throw Error(r.message||"Change password failed");return r},b=async e=>{let t=await fetch("".concat(n,"/auth/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await t.json();if(!t.ok)throw Error(a.message||"Email verification failed");return a},N=async e=>{let t=await fetch("".concat(n,"/auth/resend-verification"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await t.json();if(!t.ok)throw Error(a.message||"Resend verification failed");return a},O=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("".concat(n,"/auth/2fa/setup"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),a=await t.json();if(!t.ok)throw Error(a.message||"Setup 2FA failed");return a},C=async e=>{let t=localStorage.getItem("accessToken"),a=await fetch("".concat(n,"/auth/2fa/verify"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({token:e})}),o=await a.json();if(!a.ok)throw Error(o.message||"Verify 2FA failed");return o},E=async(e,t)=>{let a=localStorage.getItem("accessToken"),o=await fetch("".concat(n,"/auth/2fa/disable"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({verificationToken:e,currentPassword:t})}),r=await o.json();if(!o.ok)throw Error(r.message||"Disable 2FA failed");return r},P=async(e,t)=>{let a=localStorage.getItem("accessToken"),o=await fetch("".concat(n,"/auth/2fa/regenerate-backup"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({verificationToken:e,currentPassword:t})}),r=await o.json();if(!o.ok)throw Error(r.message||"Regenerate backup codes failed");return r},I=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("".concat(n,"/auth/2fa/status"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),a=await t.json();if(!t.ok)throw Error(a.message||"Get 2FA status failed");return a};return(0,o.jsx)(s.Provider,{value:{user:a,login:p,register:y,logout:w,logoutAll:T,getSessions:S,logoutSession:j,forgotPassword:k,resetPassword:x,changePassword:v,verifyEmail:b,resendVerification:N,setupTwoFactor:O,verifyTwoFactor:C,disableTwoFactor:E,regenerateBackupCodes:P,getTwoFactorStatus:I,cancelTwoFactor:()=>{localStorage.removeItem("tempLogin"),h(!1),f(null)},isLoading:c,requiresTwoFactor:u,twoFactorUserId:d},children:t})}function c(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8504:function(e,t,a){"use strict";var o=a(3226);a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}}),a.o(o,"useSearchParams")&&a.d(t,{useSearchParams:function(){return o.useSearchParams}})}},function(e){e.O(0,[115,364,744],function(){return e(e.s=1343)}),_N_E=e.O()}]);