(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{8670:function(e,t,o){Promise.resolve().then(o.bind(o,4302))},4302:function(e,t,o){"use strict";o.d(t,{default:function(){return l}});var a=o(7821),s=o(8504),r=o(8078),n=o(9926);function i(e){let{token:t}=e,[o,i]=(0,r.useState)({newPassword:"",confirmPassword:""}),[l,c]=(0,r.useState)(!1),[u,h]=(0,r.useState)(""),[d,f]=(0,r.useState)(""),{resetPassword:m}=(0,n.a)(),p=(0,s.useRouter)(),g=async e=>{if(e.preventDefault(),c(!0),h(""),f(""),o.newPassword!==o.confirmPassword){h("Passwords do not match"),c(!1);return}if(o.newPassword.length<6){h("Password must be at least 6 characters long"),c(!1);return}try{await m(t,o.newPassword,o.confirmPassword),f("Password reset successfully. Redirecting to login..."),setTimeout(()=>{p.push("/")},2e3)}catch(e){h(e.message)}finally{c(!1)}},w=e=>{i(t=>({...t,[e.target.name]:e.target.value}))};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white",children:"Reset Password"}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-gray-400",children:"Enter your new password"})]}),(0,a.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:(0,a.jsx)("div",{className:"bg-gray-800 border border-gray-700 py-8 px-4 shadow sm:rounded-lg sm:px-10",children:(0,a.jsxs)("form",{onSubmit:g,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-300",children:"New Password"}),(0,a.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",required:!0,value:o.newPassword,onChange:w,className:"mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Enter new password"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300",children:"Confirm New Password"}),(0,a.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,value:o.confirmPassword,onChange:w,className:"mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"Confirm new password"})]}),u&&(0,a.jsx)("div",{className:"text-red-400 text-sm",children:u}),d&&(0,a.jsx)("div",{className:"text-green-400 text-sm",children:d}),(0,a.jsx)("button",{type:"submit",disabled:l,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors",children:l?"Resetting Password...":"Reset Password"})]})})})]})}function l(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),o=e.get("token");return((0,r.useEffect)(()=>{o||t.push("/")},[o,t]),o)?(0,a.jsx)(i,{token:o}):null}},9926:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return n},a:function(){return i}});var a=o(7821),s=o(8078);let r=(0,s.createContext)(void 0);function n(e){let{children:t}=e,[o,n]=(0,s.useState)(null),[i,l]=(0,s.useState)(!0),[c,u]=(0,s.useState)(!1),[h,d]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=setTimeout(()=>{f()},500),t=setTimeout(()=>{l(!1)},1e4);return()=>{clearTimeout(e),clearTimeout(t)}},[]);let f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{let t=localStorage.getItem("accessToken");if(t){let o=await fetch("http://localhost:5000/auth/me",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(o.ok){let e=await o.json();n(e),l(!1)}else if(401===o.status)await m(),l(!1);else if(o.status>=500&&e<3){setTimeout(()=>f(e+1),1e3*(e+1));return}else l(!1)}else l(!1)}catch(t){if(console.error("Auth check failed:",t),e<3){setTimeout(()=>f(e+1),1e3*(e+1));return}l(!1)}},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{let t=localStorage.getItem("refreshToken");if(!t){l(!1);return}let o=await fetch("http://localhost:5000/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(o.ok){let e=await o.json();localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken);let t=await fetch("http://localhost:5000/auth/me",{headers:{Authorization:"Bearer ".concat(e.accessToken),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();n(e)}l(!1)}else if(o.status>=500&&e<3){setTimeout(()=>m(e+1),1e3*(e+1));return}else w(),l(!1)}catch(t){if(console.error("Token refresh failed:",t),e<3){setTimeout(()=>m(e+1),1e3*(e+1));return}w(),l(!1)}},p=async(e,t,o)=>{let a=await fetch("http://localhost:5000/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usernameOrEmail:e,password:t,twoFactorCode:o})}),s=await a.json();if(!a.ok)throw Error(s.message||"Login failed");return s.requiresTwoFactor?(localStorage.setItem("tempLogin",JSON.stringify({email:e,password:t})),u(!0),d(s.userId)):(localStorage.setItem("accessToken",s.accessToken),localStorage.setItem("refreshToken",s.refreshToken),n(s.user),u(!1),d(null)),s},g=async e=>{let t=await fetch("http://localhost:5000/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await t.json();if(!t.ok)throw Error(o.message||"Registration failed");return o},w=async()=>{try{{let e=localStorage.getItem("refreshToken");e&&await fetch("http://localhost:5000/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})})}}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),n(null),u(!1),d(null)}},y=async()=>{try{{let e=localStorage.getItem("accessToken");await fetch("http://localhost:5000/auth/logout-all",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})}}catch(e){console.error("Logout all error:",e)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),n(null),u(!1),d(null)}},T=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("http://localhost:5000/auth/sessions",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw Error(o.message||"Get sessions failed");return o},S=async e=>{let t=localStorage.getItem("accessToken"),o=await fetch("http://localhost:5000/auth/logout-session",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({sessionId:e})}),a=await o.json();if(!o.ok)throw Error(a.message||"Logout session failed");return a},b=async e=>{let t=await fetch("http://localhost:5000/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),o=await t.json();if(!t.ok)throw Error(o.message||"Forgot password failed");return o},k=async(e,t,o)=>{let a=await fetch("http://localhost:5000/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,newPassword:t,confirmNewPassword:o})}),s=await a.json();if(!a.ok)throw Error(s.message||"Reset password failed");return s},j=async(e,t)=>{let o=localStorage.getItem("accessToken"),a=await fetch("http://localhost:5000/auth/change-password",{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),s=await a.json();if(!a.ok)throw Error(s.message||"Change password failed");return s},x=async e=>{let t=await fetch("http://localhost:5000/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),o=await t.json();if(!t.ok)throw Error(o.message||"Email verification failed");return o},P=async e=>{let t=await fetch("http://localhost:5000/auth/resend-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),o=await t.json();if(!t.ok)throw Error(o.message||"Resend verification failed");return o},v=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("http://localhost:5000/auth/2fa/setup",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw Error(o.message||"Setup 2FA failed");return o},N=async e=>{let t=localStorage.getItem("accessToken"),o=await fetch("http://localhost:5000/auth/2fa/verify",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await o.json();if(!o.ok)throw Error(a.message||"Verify 2FA failed");return a},O=async(e,t)=>{let o=localStorage.getItem("accessToken"),a=await fetch("http://localhost:5000/auth/2fa/disable",{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({verificationToken:e,currentPassword:t})}),s=await a.json();if(!a.ok)throw Error(s.message||"Disable 2FA failed");return s},C=async(e,t)=>{let o=localStorage.getItem("accessToken"),a=await fetch("http://localhost:5000/auth/2fa/regenerate-backup",{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({verificationToken:e,currentPassword:t})}),s=await a.json();if(!a.ok)throw Error(s.message||"Regenerate backup codes failed");return s},E=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("http://localhost:5000/auth/2fa/status",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw Error(o.message||"Get 2FA status failed");return o};return(0,a.jsx)(r.Provider,{value:{user:o,login:p,register:g,logout:w,logoutAll:y,getSessions:T,logoutSession:S,forgotPassword:b,resetPassword:k,changePassword:j,verifyEmail:x,resendVerification:P,setupTwoFactor:v,verifyTwoFactor:N,disableTwoFactor:O,regenerateBackupCodes:C,getTwoFactorStatus:E,cancelTwoFactor:()=>{localStorage.removeItem("tempLogin"),u(!1),d(null)},isLoading:i,requiresTwoFactor:c,twoFactorUserId:h},children:t})}function i(){let e=(0,s.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8504:function(e,t,o){"use strict";var a=o(3226);o.o(a,"useRouter")&&o.d(t,{useRouter:function(){return a.useRouter}}),o.o(a,"useSearchParams")&&o.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[115,364,744],function(){return e(e.s=8670)}),_N_E=e.O()}]);