(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{3195:function(e,t,s){Promise.resolve().then(s.bind(s,5543))},5543:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return V},dynamic:function(){return B}});var r=s(7821),a=s(9926),n=s(8078),l=s(2949);let i=(0,n.createContext)(void 0),c=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useWebSocket must be used within a WebSocketProvider");return e},o=e=>{let{children:t,user:s}=e,a=(0,n.useRef)({}),c=(0,n.useRef)({}),o=(0,n.useCallback)((e,t,r)=>{if(a.current[e.id]&&a.current[e.id].readyState===WebSocket.OPEN){c.current[e.id]=t;return}a.current[e.id]&&a.current[e.id].readyState!==WebSocket.CLOSED&&a.current[e.id].close();let n=e.url.replace(/^http/,"ws");console.log("Attempting WebSocket connection to:",n);let i=new WebSocket(n);i.onopen=()=>{let t=s?"".concat(l.env.NEXT_PUBLIC_PAGENAME||"MeoPanel","_").concat(s.username):"unknown",a={uuid:e.uuid,token:e.token,clientName:t};i.send(JSON.stringify(a)),r&&r(i,e)},i.onmessage=t=>{let s=c.current[e.id];s&&s(t,e.id)},i.onerror=t=>{console.error("WebSocket error for server",e.servername,"URL:",n,"Error:",t)},i.onclose=s=>{console.log("WebSocket closed for server",e.servername,"code:",s.code),setTimeout(()=>{o(e,t)},5e3)},a.current[e.id]=i,c.current[e.id]=t},[s]),d=(0,n.useCallback)((e,t)=>{let s=a.current[e];s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify(t))},[]),u=(0,n.useCallback)(e=>{let t=a.current[e];t&&(t.close(),delete a.current[e],delete c.current[e])},[]),m=(0,n.useCallback)(e=>{let t=a.current[e];return t&&t.readyState===WebSocket.OPEN},[]);return(0,n.useEffect)(()=>()=>{Object.values(a.current).forEach(e=>{e.readyState===WebSocket.OPEN&&e.close()}),a.current={},c.current={}},[]),(0,r.jsx)(i.Provider,{value:{connectToServer:o,sendToServer:d,disconnectFromServer:u,isConnected:m},children:t})},d=(0,n.createContext)(void 0),u=()=>{let e=(0,n.useContext)(d);if(!e)throw Error("usePM2Data must be used within a PM2DataProvider");return e},m=e=>{let{children:t}=e,[s,a]=(0,n.useState)({});return(0,r.jsx)(d.Provider,{value:{pm2Data:s,updatePM2Data:(e,t)=>{a(s=>({...s,[e]:t}))}},children:t})};var x=s(8504);function p(e){let{activeTab:t,user:s}=e,{connectToServer:a,sendToServer:l,isConnected:i}=c(),[o,d]=(0,n.useState)([]),[u,m]=(0,n.useState)({}),[x,p]=(0,n.useState)({}),[h,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)({servername:"",url:"",uuid:"",token:""}),[y,b]=(0,n.useState)(!1),j=(0,n.useRef)({}),w=(0,n.useRef)({}),N=(0,n.useCallback)((e,s)=>{"wserver"===t&&l(s.id,{command:"status",uuid:s.uuid,token:s.token})},[t,l]);(0,n.useEffect)(()=>{S()},[]);let k=(0,n.useCallback)((e,t)=>{try{let s=e.data,r=JSON.parse(s);if(r.pong&&"ok"===r.status){p(e=>({...e,[t]:"online"}));return}if("error"===r.type){console.error("Server error:",r.message),p(e=>({...e,[t]:"offline"}));return}if("status"===r.type&&r.data){let e=r.data;m(s=>({...s,[t]:e})),p(e=>({...e,[t]:"online"}));return}}catch(e){console.error("Failed to parse server message:",e),p(e=>({...e,[t]:"offline"}))}},[]);(0,n.useEffect)(()=>{if("wserver"===t)return o.forEach(e=>{a(e,k,N)}),()=>{Object.values(j.current).forEach(clearInterval),Object.values(w.current).forEach(clearInterval),j.current={},w.current={},o.forEach(e=>{i(e.id)&&l(e.id,{command:"status-stop"})})}},[o,t,a,k,N]),(0,n.useEffect)(()=>{o.forEach(e=>{i(e.id)&&("wserver"===t?w.current[e.id]||(w.current[e.id]=setInterval(()=>{i(e.id)&&l(e.id,"ping")},3e4)):w.current[e.id]&&(clearInterval(w.current[e.id]),delete w.current[e.id]))})},[t,o,i,l]),(0,n.useEffect)(()=>{o.forEach(e=>{i(e.id)&&("wserver"===t?j.current[e.id]||(l(e.id,{command:"status",uuid:e.uuid,token:e.token}),j.current[e.id]=setTimeout(()=>{},0)):j.current[e.id]&&(l(e.id,{command:"status-stop"}),clearTimeout(j.current[e.id]),delete j.current[e.id]))})},[t,o,i,l]);let S=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch("http://".concat("192.168.100.193",":").concat("5000","/wservers"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();d(e.data||[])}}catch(e){console.error("Failed to fetch wservers:",e)}},I=async e=>{e.preventDefault(),b(!0);try{let e=localStorage.getItem("accessToken");(await fetch("http://".concat("192.168.100.193",":").concat("5000","/wservers"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(f)})).ok?(g(!1),v({servername:"",url:"",uuid:"",token:""}),S()):console.error("Failed to add wserver")}catch(e){console.error("Error adding wserver:",e)}finally{b(!1)}},P=async e=>{try{let t=localStorage.getItem("accessToken");(await fetch("http://".concat("192.168.100.193",":").concat("5000","/wservers/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).ok?S():console.error("Failed to delete wserver")}catch(e){console.error("Error deleting wserver:",e)}},C=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB","TB"][t]};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white",children:"WServer Management"}),(0,r.jsx)("button",{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors",children:"Add WServer"})]}),(0,r.jsxs)("div",{className:"grid gap-6",children:[o.map(e=>{let t=u[e.id],s=x[e.id]||"connecting";return(0,r.jsxs)("div",{className:"bg-gray-800 p-6 rounded-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-white font-medium text-lg",children:e.servername}),(0,r.jsxs)("p",{className:"text-gray-400 text-sm",children:["Server UUID: ",e.id]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>console.log("Edit",e.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded-md text-sm",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>P(e.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-sm",children:"Delete"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm ".concat("offline"===s?"opacity-50":""),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Connection Address:"}),(0,r.jsx)("p",{className:"text-white",children:(null==t?void 0:t.connection_address)||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Server Status:"}),(0,r.jsx)("p",{className:"font-medium ".concat("online"===s?"text-green-400":"connecting"===s?"text-yellow-400":"text-red-400"),children:"connecting"===s?"Connecting...":"online"===s?"Online":"Offline"})]}),t&&t.memory&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Memory:"}),(0,r.jsxs)("p",{className:"text-white",children:["Used: ",C(t.memory.used)," / Total: ",C(t.memory.total)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"CPU:"}),(0,r.jsxs)("p",{className:"text-white",children:[t.cpu.cores," cores, ",t.cpu.usage,"% usage"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Disk Space:"}),(0,r.jsxs)("p",{className:"text-white",children:["Used: ",C(t.disk_space.used)," / Max: ",C(t.disk_space.max)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Instances Status:"}),(0,r.jsxs)("p",{className:"text-white",children:["Total: ",t.total_instances,", Running: ",t.running_instances,", Stopped: ",t.stopped_instances]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"PM2 Status:"}),(0,r.jsxs)("p",{className:"text-white",children:["Total: ",t.total_pm2,", Running: ",t.running_pm2,", Stopped: ",t.stopped_pm2]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Platform:"}),(0,r.jsx)("p",{className:"text-white",children:t.platform})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Version:"}),(0,r.jsxs)("p",{className:"text-white",children:["Node: ",t.version.node,", Server: ",t.version.server]})]})]})]})]},e.id)}),0===o.length&&(0,r.jsx)("p",{className:"text-gray-400 text-center py-8",children:'No wservers found. Click "Add WServer" to add your first server.'})]}),h&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 p-6 rounded-md w-full max-w-md",children:[(0,r.jsx)("h4",{className:"text-white text-lg font-medium mb-4",children:"Add New WServer"}),(0,r.jsxs)("form",{onSubmit:I,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"Server Name"}),(0,r.jsx)("input",{type:"text",value:f.servername,onChange:e=>v({...f,servername:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"URL"}),(0,r.jsx)("input",{type:"url",value:f.url,onChange:e=>v({...f,url:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"UUID"}),(0,r.jsx)("input",{type:"text",value:f.uuid,onChange:e=>v({...f,uuid:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"Token"}),(0,r.jsx)("input",{type:"text",value:f.token,onChange:e=>v({...f,token:e.target.value}),className:"w-full bg-gray-700 text-white px-3 py-2 rounded-md",required:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 text-gray-300 hover:text-white",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:y,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50",children:y?"Adding...":"Add WServer"})]})]})]})})]})}function h(e){let{activeTab:t,user:s}=e,{connectToServer:a,sendToServer:l,isConnected:i}=c(),{updatePM2Data:o}=u(),d=e=>{var t;let s=null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase();return!!s&&["jpg","jpeg","png","gif","bmp","webp","svg"].includes(s)},m=(e,t)=>e.map(e=>({name:e.name,isDirectory:e.isDirectory,children:[],expanded:!1,path:t?"".concat(t,"/").concat(e.name):e.name})),x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map((e,s)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center p-1 rounded cursor-pointer hover:bg-gray-700 text-sm ".concat(D.selectedFiles.has(e.path)?"bg-blue-600 text-white":e.isDirectory?"text-blue-400":"text-gray-300"),style:{paddingLeft:"".concat(16*t+4,"px")},onClick:t=>{if(e.isDirectory){if(!e.expanded&&0===e.children.length){E(t=>t?{...t,loadingTreePath:e.path}:null);let t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e.path,uuid:t.uuid,token:s})}}E(t=>{if(!t)return t;let s=t=>t.map(t=>t.path===e.path?{...t,expanded:!t.expanded}:t.children?{...t,children:s(t.children)}:t);return{...t,treeData:s(t.treeData)}})}else E(t=>t?{...t,selectedFiles:new Set([e.path])}:null)},onDoubleClick:()=>{if(e.isDirectory){E(t=>t?{...t,currentPath:e.path}:null);let t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e.path,uuid:t.uuid,token:s})}}else{E(t=>{if(!t)return null;let s=t.openFiles.findIndex(t=>t.path===e.path);if(s>=0)return{...t,activeTabIndex:s};{let s=[...t.openFiles,{file:{name:e.name,isDirectory:!1},content:"",path:e.path,originalContent:"",modified:!1}];return{...t,openFiles:s,activeTabIndex:s.length-1}}});let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&l(D.serverId,{command:"pm2-read-file",id:D.process.pm_id,relativePath:e.path,uuid:t.uuid,token:t.token})}},onContextMenu:t=>{t.preventDefault(),E(s=>s?{...s,contextMenu:{x:t.clientX,y:t.clientY,file:{name:e.name,isDirectory:e.isDirectory}}}:null)},onDrop:t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&t.dataTransfer.files.length>0){let s=Array.from(t.dataTransfer.files),r=e.isDirectory?e.path:e.path.includes("/")?e.path.substring(0,e.path.lastIndexOf("/")):"";s.forEach(e=>eS(e,r));return}if(e.isDirectory&&!e.expanded){let s=t.dataTransfer.getData("text/plain");if(s&&s!==e.path){let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&(l(D.serverId,{command:"pm2-move-file",id:D.process.pm_id,sourcePath:s,destinationPath:e.path,uuid:t.uuid,token:t.token}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500))}}},onDragOver:t=>{t.dataTransfer.files&&t.dataTransfer.files.length>0?(t.preventDefault(),t.dataTransfer.dropEffect="copy"):e.isDirectory&&!e.expanded&&(t.preventDefault(),t.dataTransfer.dropEffect="move")},children:[e.isDirectory?(0,r.jsx)("span",{className:"mr-1",children:e.expanded?"▼":"▶"}):(0,r.jsx)("span",{className:"mr-1",children:"\uD83D\uDCC4"}),(0,r.jsx)("span",{children:e.name})]}),e.expanded&&e.children.length>0&&(0,r.jsx)("div",{children:x(e.children,t+1)})]},e.path))},[p,h]=(0,n.useState)([]),[g,f]=(0,n.useState)([]),[v,y]=(0,n.useState)({}),[b,j]=(0,n.useState)({}),[w,N]=(0,n.useState)({}),[k,S]=(0,n.useState)(null),[I,P]=(0,n.useState)({}),[C,T]=(0,n.useState)(null),[D,E]=(0,n.useState)(null),[M,F]=(0,n.useState)(null),[A,_]=(0,n.useState)(!0),[O,R]=(0,n.useState)(null),[z,W]=(0,n.useState)({});(0,n.useRef)(null);let U=(0,n.useRef)(null),L=(0,n.useRef)(null),B=(0,n.useRef)(null),[V,J]=(0,n.useState)(!1),[q,X]=(0,n.useState)(0),[Y,K]=(0,n.useState)(256),[Z,G]=(0,n.useState)([]),[H,Q]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=()=>S(null);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,n.useEffect)(()=>{let e=()=>{(null==D?void 0:D.contextMenu)&&E(e=>e?{...e,contextMenu:null}:null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[null==D?void 0:D.contextMenu]),(0,n.useEffect)(()=>(D?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[D]),(0,n.useEffect)(()=>{let e=e=>{if(V&&D){let t=Math.max(200,Math.min(600,Y+(e.clientX-q)));E(e=>e?{...e,sidebarWidth:t}:null)}},t=()=>{J(!1)};return V&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[V,q,Y,D]),(0,n.useEffect)(()=>{let e=e=>{if(D&&e.ctrlKey)switch(e.key){case"s":if(e.preventDefault(),D.activeTabIndex>=0){let e=D.openFiles[D.activeTabIndex],t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s=d(e.file.name)?e.content:btoa(e.content);l(D.serverId,{command:"pm2-write-file",id:D.process.pm_id,relativePath:e.path,content:s,uuid:t.uuid,token:t.token}),F("File saved successfully"),setTimeout(()=>F(null),3e3),E(e=>{if(!e||e.activeTabIndex<0)return e;let t=[...e.openFiles];return t[e.activeTabIndex].originalContent=t[e.activeTabIndex].content,t[e.activeTabIndex].modified=!1,{...e,openFiles:t}})}}break;case"a":e.preventDefault();let t=document.querySelector("textarea");t&&t.select();break;case"x":e.preventDefault(),document.execCommand("cut");break;case"c":e.preventDefault(),document.execCommand("copy");break;case"v":e.preventDefault(),document.execCommand("paste")}};return D&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[D,p,i,l]);let $=(0,n.useRef)({}),ee=(0,n.useCallback)((e,s)=>{if("pm2"===t){if("local"===s.id){let e=localStorage.getItem("accessToken");l(s.id,{uuid:s.uuid,token:e,command:"pm2-list",timestamp:Date.now()})}else l(s.id,{uuid:s.uuid,token:s.token,command:"pm2-list",timestamp:Date.now()});$.current[s.id]=setTimeout(()=>{},0)}},[t,l]),et=(0,n.useCallback)((e,t)=>{try{let s=e.data,r=JSON.parse(s);if("pm2-list"===r.type){if(y(e=>({...e,[t]:r.data||[]})),j(e=>({...e,[t]:"online"})),r.timestamp){let e=Date.now()-r.timestamp;N(s=>({...s,[t]:e}))}}else if("error"===r.type)console.error("Server error:",r.message),alert("Error: ".concat(r.message));else if("pm2-send"===r.type)console.log("Data sent to process successfully"),R({message:"Data sent to process successfully",type:"success"});else if("pm2-start"===r.type&&"success"===r.status)R({message:"Process started successfully",type:"success"});else if("pm2-stop"===r.type&&"success"===r.status)R({message:"Process stopped successfully",type:"success"});else if("pm2-restart"===r.type&&"success"===r.status)R({message:"Process restarted successfully",type:"success"});else if("pm2-delete"===r.type&&"success"===r.status)R({message:"Process deleted successfully",type:"success"});else if("pm2-save"===r.type&&"success"===r.status)R({message:"Processes saved successfully",type:"success"});else if("pm2-resurrect"===r.type&&"success"===r.status)R({message:"Processes resurrected successfully",type:"success"});else if("pm2-logs"===r.type)T(e=>e?1===e.logs.length&&"Loading logs..."===e.logs[0]?{...e,logs:r.data}:{...e,logs:[...e.logs,...r.data]}:null);else if("pm2-list-files"===r.type)E(e=>{if(!e)return null;if(!e.loadingTreePath)return{...e,files:r.data,treeData:m(r.data,e.currentPath)};{let t=s=>s.map(s=>s.path===e.loadingTreePath?{...s,children:m(r.data,s.path),expanded:!0}:s.children?{...s,children:t(s.children)}:s);return{...e,treeData:t(e.treeData),loadingTreePath:null}}});else if("pm2-read-file"===r.type)E(e=>{if(!e||e.activeTabIndex<0)return e;let t=[...e.openFiles],s=d(t[e.activeTabIndex].file.name)?r.data:atob(r.data);return t[e.activeTabIndex].content=s,t[e.activeTabIndex].originalContent=s,t[e.activeTabIndex].modified=!1,{...e,openFiles:t}});else if("pm2-write-file"===r.type)F("File saved successfully"),setTimeout(()=>{F(null)},3e3);else if("pm2-create-file"===r.type)R({message:"File created successfully",type:"success"});else if("pm2-create-folder"===r.type)R({message:"Folder created successfully",type:"success"});else if("pm2-delete-files"===r.type)R({message:"Files deleted successfully",type:"success"});else if("pm2-rename-file"===r.type)R({message:"File renamed successfully",type:"success"});else if("pm2-move-file"===r.type)R({message:"File moved successfully",type:"success"});else if("pm2-paste-files"===r.type)R({message:"Files pasted successfully",type:"success"});else if("pm2-zip-files"===r.type)R({message:"Files zipped successfully",type:"success"}),E(e=>e?{...e,zippingProgress:null}:null);else if("pm2-zip-progress"===r.type)E(e=>e?{...e,zippingProgress:r.progress}:null);else if("pm2-unzip-file"===r.type)R({message:"File unzipped successfully",type:"success"});else if("pm2-upload-file"===r.type){if(R({message:"File uploaded successfully",type:"success"}),E(e=>e?{...e,uploadProgress:null}:null),D){let e=p.find(e=>e.id===D.serverId);if(e&&i(D.serverId)){let t="local"===D.serverId?localStorage.getItem("accessToken"):e.token;l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:e.uuid,token:t})}}}else if("pm2-download-file"===r.type){let e=document.createElement("a");e.href="data:application/octet-stream;base64,".concat(r.data.data),e.download=r.data.fileName,document.body.appendChild(e),e.click(),document.body.removeChild(e),R({message:"File downloaded successfully",type:"success"})}else j(e=>({...e,[t]:"online"}))}catch(e){console.error("Failed to parse server message:",e),j(e=>({...e,[t]:"offline"}))}},[]);(0,n.useEffect)(()=>{es(),er()},[]),(0,n.useEffect)(()=>{if("pm2"===t)return p.forEach(e=>{a(e,et,ee)}),()=>{p.forEach(e=>{i(e.id)&&l(e.id,{uuid:e.uuid,token:e.token,command:"pm2-stop-list"})}),Object.values($.current).forEach(clearTimeout),$.current={}}},[p,t,a,et,ee]),(0,n.useEffect)(()=>{p.forEach(e=>{if(i(e.id)){if("pm2"===t){if(!$.current[e.id]){let t="local"===e.id?localStorage.getItem("accessToken"):e.token;l(e.id,{uuid:e.uuid,token:t,command:"pm2-list",timestamp:Date.now()}),$.current[e.id]=setTimeout(()=>{},0)}}else $.current[e.id]&&(l(e.id,{uuid:e.uuid,token:e.token,command:"pm2-stop-list"}),clearTimeout($.current[e.id]),delete $.current[e.id])}})},[t,p,i,l]),(0,n.useEffect)(()=>{A&&U.current&&C&&(U.current.scrollTop=U.current.scrollHeight)},[null==C?void 0:C.logs,A]),(0,n.useEffect)(()=>{if(O){let e=setTimeout(()=>R(null),3e3);return()=>clearTimeout(e)}},[O]);let es=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch("http://".concat("192.168.100.193",":").concat("5000","/wservers"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=(await t.json()).data||[],s=e.find(e=>"Local Server"===e.servername);s?h([s,...e.filter(e=>"Local Server"!==e.servername)]):h(e)}else console.log("Not authorized to fetch wservers"),h([])}catch(e){console.error("Failed to fetch wservers:",e),h([])}},er=async()=>{if(!s){Q(!1);return}try{let e=localStorage.getItem("accessToken"),t=await fetch("http://".concat("192.168.100.193",":").concat("5000","/pm2-permissions/user/").concat(s.id),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();G(e)}}catch(e){console.error("Failed to fetch user permissions:",e)}finally{Q(!1)}},ea=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB","TB"][t]},en=e=>{if(!e||e<=0)return"--:--:--";let t=Math.floor(e/1e3);return"".concat(Math.floor(t/3600).toString().padStart(2,"0"),":").concat(Math.floor(t%3600/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))},el=e=>{let t=e.length;return{total:t,running:e.filter(e=>"online"===e.pm2_env.status).length,stopped:e.filter(e=>"stopped"===e.pm2_env.status).length,error:e.filter(e=>"errored"===e.pm2_env.status).length}},ei=(e,t,r)=>{if(s&&("ADMIN"===s.role||"OWNER"===s.role))return!0;let a=Z.find(s=>s.wserverId===e&&s.pm2ProcessName===t);return!!a&&a.permissions.includes(r)},ec=()=>Object.values(I).reduce((e,t)=>e+t.size,0),eo=async(e,t,s)=>{let r=p.find(t=>t.id===e);if(i(e)&&r){let a={command:"pm2-".concat(t),uuid:r.uuid,token:r.token};"start"===t?(a.script=s.name,a.name=s.name):a.id=s.pm_id,l(e,a),setTimeout(()=>{i(e)&&l(e,{command:"pm2-list",uuid:r.uuid,token:r.token})},1e3)}},ed=async e=>{if(0===ec())return;let t={};p.forEach(e=>{let s=I[e.id]||new Set;s.size>0&&(t[e.id]=Array.from(s))}),Object.entries(t).forEach(t=>{let[s,r]=t,a=p.find(e=>e.id===s);if(i(s)&&a){let t={command:"pm2-multi-".concat(e),uuid:a.uuid,token:a.token};if("start"===e){let e=r.map(e=>{let t=v[s].find(t=>t.name===e);return t?{script:t.name,name:t.name}:null}).filter(Boolean);t.processes=e}else{let e=r.map(e=>{let t=v[s].find(t=>t.name===e);return t?t.pm_id:null}).filter(Boolean);t.ids=e}l(s,t),setTimeout(()=>{i(s)&&l(s,{command:"pm2-list",uuid:a.uuid,token:a.token})},1e3)}}),P({})},eu=async(e,t)=>{let s=p.find(t=>t.id===e);if(i(e)&&s){let r="local"===e?localStorage.getItem("accessToken"):s.token;l(e,{command:"pm2-".concat(t),uuid:s.uuid,token:r}),setTimeout(()=>{i(e)&&l(e,{command:"pm2-list",uuid:s.uuid,token:r})},1e3)}},em=(e,t)=>{let s=v[e]||[],r=[];if("all"===t)r=s;else if("running"===t)r=s.filter(e=>"online"===e.pm2_env.status);else if("stopped"===t)r=s.filter(e=>"stopped"===e.pm2_env.status);else if("error"===t)r=s.filter(e=>"errored"===e.pm2_env.status);else if("unselect"===t){P(t=>({...t,[e]:new Set}));return}P(t=>({...t,[e]:new Set(r.map(e=>e.name))}))},ex=async(e,t)=>{let s=p.find(t=>t.id===e);if(i(e)&&s){T({serverId:e,process:t,logs:["Loading logs..."],command:""}),l(e,{command:"pm2-logs",id:t.pm_id,uuid:s.uuid,token:s.token});let r=!0,a=!1;L.current=(e,t)=>{try{let t=JSON.parse(e.data);"pm2-logs"===t.type&&(a=!0,T(e=>e?r?(r=!1,{...e,logs:t.data}):{...e,logs:[...e.logs,...t.data]}:null))}catch(e){}},setTimeout(()=>{a||T(e=>e&&1===e.logs.length&&"Loading logs..."===e.logs[0]?{...e,logs:["Failed to load logs"]}:e)},5e3)}},ep=async(e,t)=>{let s=p.find(t=>t.id===e);if(i(e)&&s){E({serverId:e,process:t,currentPath:"",files:[],treeData:[],loadingTreePath:null,isTreeView:!0,uploadTargetPath:null,openFiles:[],activeTabIndex:-1,sidebarWidth:256,wordWrap:!0,sidebarVisible:!0,selectedFiles:new Set,clipboard:null,contextMenu:null,isSelecting:!1,selectionStart:null,renamingFile:null,zippingProgress:null,uploadProgress:null});let r="local"===e?localStorage.getItem("accessToken"):s.token;l(e,{command:"pm2-list-files",id:t.pm_id,relativePath:"",uuid:s.uuid,token:r})}},eh=(e,t,s)=>{let r=p.find(t=>t.id===e);i(e)&&r&&s.trim()&&(l(e,{command:"pm2-send",id:t.pm_id,data:s,uuid:r.uuid,token:r.token}),T(e=>e?{...e,command:""}:null))},eg=e=>{if(!D)return;let t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s=D.currentPath?"".concat(D.currentPath,"/").concat(e):e,r="local"===D.serverId?localStorage.getItem("accessToken"):t.token;l(D.serverId,{command:"pm2-create-file",id:D.process.pm_id,relativePath:s,content:"",uuid:t.uuid,token:r}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500)}},ef=e=>{if(!D)return;let t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s=D.currentPath?"".concat(D.currentPath,"/").concat(e):e,r="local"===D.serverId?localStorage.getItem("accessToken"):t.token;l(D.serverId,{command:"pm2-create-folder",id:D.process.pm_id,relativePath:s,uuid:t.uuid,token:r}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500)}},ev=(e,t)=>{if(!D)return;let s=p.find(e=>e.id===D.serverId);s&&i(D.serverId)&&(l(D.serverId,{command:"pm2-rename-file",id:D.process.pm_id,oldPath:e,newName:t,uuid:s.uuid,token:s.token}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500))},ey=e=>{if(!D)return;let t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;l(D.serverId,{command:"pm2-delete-files",id:D.process.pm_id,filePaths:e,uuid:t.uuid,token:s}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500)}},eb=e=>{if(!D)return;let t=D.files.filter(t=>e.includes(D.currentPath?"".concat(D.currentPath,"/").concat(t.name):t.name));E(e=>e?{...e,clipboard:{type:"copy",files:t},selectedFiles:new Set}:null)},ej=e=>{if(!D)return;let t=D.files.filter(t=>e.includes(D.currentPath?"".concat(D.currentPath,"/").concat(t.name):t.name));E(e=>e?{...e,clipboard:{type:"cut",files:t},selectedFiles:new Set}:null)},ew=()=>{if(!D||!D.clipboard)return;let e=p.find(e=>e.id===D.serverId);e&&i(D.serverId)&&(l(D.serverId,{command:"pm2-paste-files",id:D.process.pm_id,clipboard:D.clipboard,destinationPath:D.currentPath,uuid:e.uuid,token:e.token}),"cut"===D.clipboard.type&&E(e=>e?{...e,clipboard:null}:null),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:e.uuid,token:e.token})},500))},eN=(e,t)=>{if(!D)return;let s=p.find(e=>e.id===D.serverId);s&&i(D.serverId)&&(E(e=>e?{...e,zippingProgress:0}:null),l(D.serverId,{command:"pm2-zip-files",id:D.process.pm_id,filePaths:e,zipName:t,uuid:s.uuid,token:s.token}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500))},ek=e=>{if(!D)return;let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&(l(D.serverId,{command:"pm2-unzip-file",id:D.process.pm_id,zipPath:e,destinationPath:D.currentPath,uuid:t.uuid,token:t.token}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500))},eS=(e,t)=>{if(!D)return;let s=t||D.currentPath,r=p.find(e=>e.id===D.serverId);if(r&&i(D.serverId)){E(t=>t?{...t,uploadProgress:{fileName:e.name,progress:0}}:null);let t=new FileReader;t.onprogress=t=>{if(t.lengthComputable){let s=Math.round(t.loaded/t.total*100);E(t=>t?{...t,uploadProgress:{fileName:e.name,progress:s}}:null)}},t.onload=t=>{var a;E(t=>t?{...t,uploadProgress:{fileName:e.name,progress:100}}:null);let n=(null===(a=t.target)||void 0===a?void 0:a.result).split(",")[1],i="local"===D.serverId?localStorage.getItem("accessToken"):r.token;l(D.serverId,{command:"pm2-upload-file",id:D.process.pm_id,relativePath:s,fileData:n,fileName:e.name,uuid:r.uuid,token:i}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:s,uuid:r.uuid,token:i})},100)},t.readAsDataURL(e)}},eI=e=>{if(!D)return;let t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s="local"===D.serverId?localStorage.getItem("accessToken"):t.token;l(D.serverId,{command:"pm2-download-file",id:D.process.pm_id,relativePath:e,uuid:t.uuid,token:s})}},eP=e=>{let t={};"all"===e?p.forEach(e=>{let s=v[e.id]||[];t[e.id]=new Set(s.map(e=>e.name))}):"running"===e?p.forEach(e=>{let s=v[e.id]||[];t[e.id]=new Set(s.filter(e=>"online"===e.pm2_env.status).map(e=>e.name))}):"stopped"===e?p.forEach(e=>{let s=v[e.id]||[];t[e.id]=new Set(s.filter(e=>"stopped"===e.pm2_env.status).map(e=>e.name))}):"error"===e?p.forEach(e=>{let s=v[e.id]||[];t[e.id]=new Set(s.filter(e=>"errored"===e.pm2_env.status).map(e=>e.name))}):"unselect"===e&&(t={}),P(t)};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white",children:"PM2 Management"}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-gray-300 text-sm mr-2",children:"Global Select:"}),(0,r.jsxs)("select",{onChange:e=>eP(e.target.value),className:"bg-gray-700 text-gray-300 text-sm rounded px-2 py-1",children:[(0,r.jsx)("option",{value:"",children:"Select..."}),(0,r.jsx)("option",{value:"all",children:"All"}),(0,r.jsx)("option",{value:"running",children:"Online"}),(0,r.jsx)("option",{value:"stopped",children:"Stopped"}),(0,r.jsx)("option",{value:"error",children:"Error"}),(0,r.jsx)("option",{value:"unselect",children:"Unselect All"})]})]})]}),O&&(0,r.jsx)("div",{className:"mb-4 p-3 rounded ".concat("success"===O.type?"bg-green-600":"bg-red-600"," text-white"),children:O.message}),p.map(e=>{let t=v[e.id]||[],a=s&&("ADMIN"===s.role||"OWNER"===s.role)?t:H?[]:t.filter(t=>ei(e.id,t.name,"view")),n=b[e.id]||"connecting",c=el(a),o=z[e.id]||!1;return(0,r.jsxs)("div",{className:"mb-8 bg-gray-800 rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("button",{onClick:()=>W(t=>({...t,[e.id]:!t[e.id]})),className:"text-white mr-2",children:o?"▶":"▼"}),(0,r.jsx)("h4",{className:"text-white font-medium",children:e.servername}),(0,r.jsx)("span",{className:"ml-2 text-sm ".concat("online"===n?"text-green-400":"connecting"===n?"text-yellow-400":"text-red-400"),children:"connecting"===n?"Connecting...":"online"===n?"Online":"Offline"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-300",children:[s&&"ADMIN"!==s.role&&"OWNER"!==s.role&&(0,r.jsx)("span",{children:"Version: 1.0.0"}),(0,r.jsxs)("span",{children:["Amount: ",c.total]}),(0,r.jsxs)("span",{children:["Run: ",c.running]}),(0,r.jsxs)("span",{children:["Stop: ",c.stopped]}),(0,r.jsxs)("span",{children:["Error: ",c.error]}),(0,r.jsxs)("span",{children:["Ping: ",w[e.id]?"".concat(w[e.id],"ms"):"N/A"]}),(s&&("ADMIN"===s.role||"OWNER"===s.role)||Z.some(t=>t.wserverId===e.id))&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>eu(e.id,"save"),className:"px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700",children:"Save"}),(0,r.jsx)("button",{onClick:()=>eu(e.id,"resurrect"),className:"px-3 py-1 bg-orange-600 text-white text-sm rounded hover:bg-orange-700",children:"Resurrect"})]})]})]}),!o&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left table-fixed",children:[(0,r.jsx)("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"w-12 px-1 py-2 text-xs font-medium text-gray-300 uppercase",children:(0,r.jsxs)("select",{value:"",onChange:t=>em(e.id,t.target.value),onMouseDown:e=>e.stopPropagation(),onMouseUp:e=>e.stopPropagation(),className:"bg-gray-700 text-gray-300 text-xs rounded px-0.5 py-1 w-full",children:[(0,r.jsx)("option",{value:"",children:"☑"}),(0,r.jsx)("option",{value:"all",children:"All"}),(0,r.jsx)("option",{value:"running",children:"Online"}),(0,r.jsx)("option",{value:"stopped",children:"Stopped"}),(0,r.jsx)("option",{value:"error",children:"Error"}),(0,r.jsx)("option",{value:"unselect",children:"Unselect"})]})}),(0,r.jsx)("th",{className:"w-12 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"ID"}),(0,r.jsx)("th",{className:"w-32 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Name"}),(0,r.jsx)("th",{className:"w-16 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"PID"}),(0,r.jsx)("th",{className:"w-20 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Status"}),(0,r.jsx)("th",{className:"w-16 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"CPU"}),(0,r.jsx)("th",{className:"w-20 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Memory"}),(0,r.jsx)("th",{className:"w-20 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Uptime"}),(0,r.jsx)("th",{className:"w-12 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"↻"}),(0,r.jsx)("th",{className:"w-32 px-4 py-2 text-xs font-medium text-gray-300 uppercase",children:"Note"})]})}),(0,r.jsxs)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:[a.map(t=>{var s,a;return(0,r.jsxs)("tr",{className:(null===(s=I[e.id])||void 0===s?void 0:s.has(t.name))?"bg-gray-700":"",onContextMenu:s=>{s.preventDefault(),S({x:s.clientX,y:s.clientY,process:t,serverId:e.id})},children:[(0,r.jsx)("td",{className:"w-12 px-2 py-2 text-white",children:(0,r.jsx)("input",{type:"checkbox",checked:(null===(a=I[e.id])||void 0===a?void 0:a.has(t.name))||!1,onChange:s=>{P(r=>{let a=new Set(r[e.id]||new Set);return s.target.checked?a.add(t.name):a.delete(t.name),{...r,[e.id]:a}})},className:"rounded"})}),(0,r.jsx)("td",{className:"w-12 px-4 py-2 text-white",children:t.pm_id}),(0,r.jsx)("td",{className:"w-32 px-4 py-2 text-white",children:t.name}),(0,r.jsx)("td",{className:"w-16 px-4 py-2 text-white",children:t.pid}),(0,r.jsx)("td",{className:"w-20 px-4 py-2 text-white",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("online"===t.pm2_env.status?"bg-green-600 text-white":"stopped"===t.pm2_env.status?"bg-red-600 text-white":"bg-yellow-600 text-white"),children:t.pm2_env.status})}),(0,r.jsxs)("td",{className:"w-16 px-4 py-2 text-white",children:[t.monit.cpu.toFixed(1),"%"]}),(0,r.jsx)("td",{className:"w-20 px-4 py-2 text-white",children:ea(t.monit.memory)}),(0,r.jsx)("td",{className:"w-20 px-4 py-2 text-white",children:"online"===t.pm2_env.status?en(Date.now()-t.pm2_env.pm_uptime):"N/A"}),(0,r.jsx)("td",{className:"w-12 px-4 py-2 text-white",children:t.pm2_env.restart_time}),(0,r.jsx)("td",{className:"w-32 px-4 py-2 text-white",children:ei(e.id,t.name,"edit_note")?(0,r.jsx)("input",{type:"text",value:t.note||"",onChange:s=>{let r=s.target.value;y(s=>({...s,[e.id]:s[e.id].map(e=>e.name===t.name?{...e,note:r}:e)}))},onBlur:()=>{i(e.id)&&l(e.id,{command:"pm2-notes-set",uuid:e.uuid,token:e.token,process_name:t.name,note:t.note||""})},onMouseDown:e=>e.stopPropagation(),onMouseUp:e=>e.stopPropagation(),className:"bg-gray-700 text-white text-xs rounded px-1 py-1 w-full",placeholder:"Add note..."}):(0,r.jsx)("span",{className:"text-xs",children:t.note||"N/A"})})]},"".concat(e.id,"-").concat(t.pm_id))}),0===a.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:10,className:"px-4 py-8 text-center text-gray-400",children:H&&s&&"ADMIN"!==s.role&&"OWNER"!==s.role?"Loading permissions...":"No PM2 processes found or connecting..."})})]})]})})})]},e.id)}),ec()>0&&(0,r.jsxs)("div",{className:"mt-8 bg-gray-800 rounded-lg p-4",children:[(0,r.jsxs)("h4",{className:"text-white font-medium mb-4",children:["Selected Processes (",ec(),")"]}),(0,r.jsx)("div",{className:"mb-4 max-h-32 overflow-y-auto",children:(()=>{let e=[];return p.forEach(t=>{(I[t.id]||new Set).forEach(s=>{e.push({serverName:t.servername,processName:s})})}),e})().map((e,t)=>(0,r.jsxs)("div",{className:"text-gray-300 text-sm",children:[e.serverName," - ",e.processName]},t))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>ed("start"),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:"Start Selected"}),(0,r.jsx)("button",{onClick:()=>ed("stop"),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Stop Selected"}),(0,r.jsx)("button",{onClick:()=>ed("restart"),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Restart Selected"}),(0,r.jsx)("button",{onClick:()=>ed("delete"),className:"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700",children:"Delete Selected"}),(0,r.jsx)("button",{onClick:()=>P({}),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600",children:"Clear Selection"})]})]}),0===p.length&&(0,r.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No servers configured. Add servers in the WServer tab."}),M&&(0,r.jsx)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white px-6 py-3 rounded shadow-lg text-center",style:{zIndex:1e4},children:M}),k&&(0,r.jsxs)("div",{className:"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1",style:{left:k.x,top:k.y},children:["online"===k.process.pm2_env.status?(0,r.jsx)(r.Fragment,{children:ei(k.serverId,k.process.name,"control")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{eo(k.serverId,"restart",k.process),S(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Restart"}),(0,r.jsx)("button",{onClick:()=>{eo(k.serverId,"stop",k.process),S(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Stop"})]})}):ei(k.serverId,k.process.name,"control")&&(0,r.jsx)("button",{onClick:()=>{eo(k.serverId,"start",k.process),S(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Start"}),(0,r.jsx)("button",{onClick:()=>{ex(k.serverId,k.process),S(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"View Logs"}),ei(k.serverId,k.process.name,"control_file")&&(0,r.jsx)("button",{onClick:()=>{ep(k.serverId,k.process),S(null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"View File"}),ei(k.serverId,k.process.name,"control")&&(0,r.jsx)("button",{onClick:()=>{eo(k.serverId,"delete",k.process),S(null)},className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:"Delete"})]}),C&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-6xl max-h-3/4 flex flex-col",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-white",children:["Logs for ",C.process.name]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("button",{onClick:()=>ex(C.serverId,C.process),className:"text-gray-400 hover:text-white mr-2",title:"Refresh logs",children:"\uD83D\uDD04"}),(0,r.jsx)("button",{onClick:()=>{if(C){let e=p.find(e=>e.id===C.serverId);e&&i(C.serverId)&&(l(C.serverId,{command:"pm2-stop-logs",id:C.process.pm_id,uuid:e.uuid,token:e.token}),L.current=null)}T(null)},className:"text-gray-400 hover:text-white",children:"✕"})]})]}),(0,r.jsxs)("div",{className:"mb-4 bg-gray-700 rounded p-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:"Status:"}),(0,r.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat("online"===C.process.pm2_env.status?"bg-green-600 text-white":"stopped"===C.process.pm2_env.status?"bg-red-600 text-white":"bg-yellow-600 text-white"),children:C.process.pm2_env.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:"CPU:"}),(0,r.jsxs)("span",{className:"ml-2 text-white",children:[C.process.monit.cpu.toFixed(1),"%"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:"Memory:"}),(0,r.jsx)("span",{className:"ml-2 text-white",children:ea(C.process.monit.memory)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:"Uptime:"}),(0,r.jsx)("span",{className:"ml-2 text-white",children:"online"===C.process.pm2_env.status?en(Date.now()-C.process.pm2_env.pm_uptime):"N/A"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:["online"!==C.process.pm2_env.status&&(0,r.jsx)("button",{onClick:()=>eo(C.serverId,"start",C.process),className:"px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:"Start"}),"online"===C.process.pm2_env.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>eo(C.serverId,"restart",C.process),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Restart"}),(0,r.jsx)("button",{onClick:()=>eo(C.serverId,"stop",C.process),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Stop"})]}),(0,r.jsx)("button",{onClick:()=>eo(C.serverId,"delete",C.process),className:"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700",children:"Delete"})]})]}),(0,r.jsx)("div",{ref:U,onScroll:()=>{if(U.current){let{scrollTop:e,scrollHeight:t,clientHeight:s}=U.current;_(e+s>=t-10)}},className:"flex-1 bg-black rounded p-4 mb-4 overflow-auto max-h-96",children:(0,r.jsx)("pre",{className:"text-green-400 text-sm whitespace-pre-wrap",children:C.logs.join("\n")})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:C.command,onChange:e=>T(t=>t?{...t,command:e.target.value}:null),onKeyPress:e=>{"Enter"===e.key&&eh(C.serverId,C.process,C.command)},placeholder:"Enter data to send to process (e.g., 5+5)",className:"flex-1 px-3 py-2 bg-gray-700 text-white rounded text-sm"}),(0,r.jsx)("button",{onClick:()=>eh(C.serverId,C.process,C.command),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Send"})]})]})}),D&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-gray-900 overflow-hidden",children:(0,r.jsxs)("div",{className:"h-full flex flex-col max-h-screen",children:[(0,r.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-1 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-gray-400 mr-2",children:"\uD83D\uDCC1"}),(0,r.jsx)("span",{className:"text-white font-medium",children:D.process.name}),(0,r.jsx)("span",{className:"text-gray-400 mx-2",children:"-"}),(0,r.jsxs)("span",{className:"text-gray-300 text-sm",children:[D.process.pm2_env.pm_cwd,D.currentPath]})]}),(null!==D.zippingProgress||null!==D.uploadProgress)&&(0,r.jsxs)("div",{className:"flex items-center mr-4 space-x-4",children:[null!==D.zippingProgress&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("span",{className:"text-gray-300 text-sm mr-2",children:["Zipping: ",D.zippingProgress,"%"]}),(0,r.jsx)("div",{className:"w-32 bg-gray-700 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(D.zippingProgress,"%")}})})]}),null!==D.uploadProgress&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("span",{className:"text-gray-300 text-sm mr-2",children:["Uploading ",D.uploadProgress.fileName,": ",D.uploadProgress.progress,"%"]}),(0,r.jsx)("div",{className:"w-32 bg-gray-700 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(D.uploadProgress.progress,"%")}})})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"file",ref:B,onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(eS(s,D.uploadTargetPath),E(e=>e?{...e,uploadTargetPath:null}:null),e.target.value="")},style:{display:"none"}}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=B.current)||void 0===e?void 0:e.click()},className:"text-gray-400 hover:text-white p-1",title:"Upload File",children:"⬆"}),(0,r.jsx)("button",{onClick:()=>E(e=>e?{...e,isTreeView:!e.isTreeView}:null),className:"text-gray-400 hover:text-white p-1",title:(null==D?void 0:D.isTreeView)?"Switch to List View":"Switch to Tree View",children:(null==D?void 0:D.isTreeView)?"\uD83D\uDCC2":"\uD83D\uDCCB"}),(0,r.jsx)("button",{onClick:()=>{D.selectedFiles.size>0&&Array.from(D.selectedFiles).forEach(e=>{eI(e)})},className:"text-gray-400 hover:text-white p-1",title:"Download Selected",disabled:0===D.selectedFiles.size,children:"⬇"}),(0,r.jsx)("div",{className:"w-px h-4 bg-gray-600"}),(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eg(e)},className:"text-gray-400 hover:text-white p-1",title:"Create File",children:"\uD83D\uDCC4+"}),(0,r.jsx)("button",{onClick:()=>{D.selectedFiles.size>0&&eb(Array.from(D.selectedFiles))},className:"text-gray-400 hover:text-white p-1",title:"Copy Selected",disabled:0===D.selectedFiles.size,children:"\uD83D\uDCCB"}),(0,r.jsx)("button",{onClick:()=>{D.selectedFiles.size>0&&ej(Array.from(D.selectedFiles))},className:"text-gray-400 hover:text-white p-1",title:"Cut Selected",disabled:0===D.selectedFiles.size,children:"✂"}),(0,r.jsx)("button",{onClick:()=>{D.clipboard&&ew()},className:"text-gray-400 hover:text-white p-1",title:"Paste",disabled:!D.clipboard,children:"\uD83D\uDCC4"}),(0,r.jsx)("button",{onClick:()=>{if(D.selectedFiles.size>0){let e=prompt("Enter zip file name:","selected_files.zip");e&&eN(Array.from(D.selectedFiles),e)}},className:"text-gray-400 hover:text-white p-1",title:"Zip Selected",disabled:0===D.selectedFiles.size,children:"\uD83D\uDCE6"}),(0,r.jsx)("button",{onClick:()=>{D.selectedFiles.size>0&&confirm("Delete ".concat(D.selectedFiles.size," selected items?"))&&ey(Array.from(D.selectedFiles))},className:"text-gray-400 hover:text-red-400 p-1",title:"Delete Selected",disabled:0===D.selectedFiles.size,children:"\uD83D\uDDD1"}),(0,r.jsx)("div",{className:"w-px h-4 bg-gray-600"}),(0,r.jsx)("button",{onClick:()=>{let e=p.find(e=>e.id===D.serverId);e&&i(D.serverId)&&l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:e.uuid,token:e.token})},className:"text-gray-400 hover:text-white p-1",title:"Refresh",children:"\uD83D\uDD04"}),(0,r.jsx)("button",{onClick:()=>E(null),className:"text-gray-400 hover:text-white p-1",title:"Close",children:"✕"})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[D.sidebarVisible&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-gray-800 border-r border-gray-700 flex flex-col min-h-0",style:{width:D.sidebarWidth},children:[(0,r.jsx)("div",{className:"p-3 border-b border-gray-700",children:(0,r.jsx)("h3",{className:"text-white font-medium text-sm",children:"EXPLORER"})}),(0,r.jsx)("div",{className:"flex-1 overflow-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",style:{scrollbarWidth:"thin",scrollbarColor:"#4B5563 #1F2937",WebkitScrollbarWidth:"thin",WebkitScrollbarTrack:"background: #1F2937",WebkitScrollbarThumb:"background: #4B5563"},children:(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsx)("div",{className:"mb-2 text-xs text-gray-400 cursor-pointer hover:bg-gray-700 p-1 rounded",onContextMenu:e=>{e.preventDefault(),E(t=>t?{...t,contextMenu:{x:e.clientX,y:e.clientY,file:null},selectedFiles:new Set}:null)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.files).forEach(e=>eS(e))},children:D.currentPath?(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath.split("/").slice(0,-1).join("/")||"";E(t=>t?{...t,currentPath:e}:null);let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e,uuid:t.uuid,token:t.token})},className:"text-blue-400 hover:text-blue-300 mr-2 px-2 py-1 rounded hover:bg-gray-700 flex items-center",title:"Go back",children:"← .."}),(0,r.jsx)("span",{children:"/"}),D.currentPath.split("/").map((e,t)=>(0,r.jsxs)("span",{children:[t>0&&"/",(0,r.jsx)("span",{className:"text-gray-300",children:e})]},t))]}):(0,r.jsx)("span",{children:"Root"})}),(0,r.jsx)("div",{className:"flex-1 space-y-1 select-none bg-gray-800",onMouseDown:e=>{e.target===e.currentTarget&&E(e=>e?{...e,selectedFiles:new Set}:null)},onContextMenu:e=>{e.target===e.currentTarget&&(e.preventDefault(),E(t=>t?{...t,contextMenu:{x:e.clientX,y:e.clientY,file:null},selectedFiles:new Set}:null))},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.files).forEach(e=>eS(e))},children:D.isTreeView?x(D.treeData):D.files.map((e,t)=>{let s=D.currentPath?"".concat(D.currentPath,"/").concat(e.name):e.name,a=D.selectedFiles.has(s),n=D.renamingFile===s;return(0,r.jsxs)("div",{draggable:!n,onMouseDown:e=>{if(n)return;e.preventDefault();let r=new Set(D.selectedFiles);if(e.ctrlKey||e.metaKey)a?r.delete(s):r.add(s);else if(e.shiftKey&&null!==D.selectionStart){let e=D.selectionStart,s=Math.min(e,t),a=Math.max(e,t);for(let e=s;e<=a;e++){let t=D.files[e],s=D.currentPath?"".concat(D.currentPath,"/").concat(t.name):t.name;r.add(s)}}else r.clear(),r.add(s),E(e=>e?{...e,selectionStart:t}:null);E(e=>e?{...e,selectedFiles:r,isSelecting:!0}:null)},onMouseEnter:e=>{if(D.isSelecting&&1===e.buttons){let e=new Set(D.selectedFiles),s=D.selectionStart,r=Math.min(s,t),a=Math.max(s,t);e.clear();for(let t=r;t<=a;t++){let s=D.files[t],r=D.currentPath?"".concat(D.currentPath,"/").concat(s.name):s.name;e.add(r)}E(t=>t?{...t,selectedFiles:e}:null)}},onMouseUp:()=>{E(e=>e?{...e,isSelecting:!1}:null)},onDragStart:e=>{n||(e.dataTransfer.setData("text/plain",s),e.dataTransfer.effectAllowed="move")},onDragOver:t=>{t.dataTransfer.files&&t.dataTransfer.files.length>0?(t.preventDefault(),t.dataTransfer.dropEffect="copy"):e.isDirectory&&!n&&(t.preventDefault(),t.dataTransfer.dropEffect="move")},onDrop:t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&t.dataTransfer.files.length>0){let r=Array.from(t.dataTransfer.files),a=e.isDirectory?s:s.includes("/")?s.substring(0,s.lastIndexOf("/")):"";r.forEach(e=>eS(e,a));return}if(e.isDirectory&&!n){let e=t.dataTransfer.getData("text/plain");if(e&&e!==s){let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&(l(D.serverId,{command:"pm2-move-file",id:D.process.pm_id,sourcePath:e,destinationPath:s,uuid:t.uuid,token:t.token}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:t.uuid,token:t.token})},500))}}},onDoubleClick:()=>{if(!n){if(e.isDirectory){let t=D.currentPath?"".concat(D.currentPath,"/").concat(e.name):e.name;E(e=>e?{...e,currentPath:t}:null);let s=p.find(e=>e.id===D.serverId);s&&i(D.serverId)&&l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:t,uuid:s.uuid,token:s.token})}else{E(t=>{if(!t)return null;let r=t.openFiles.findIndex(e=>e.path===s);if(r>=0)return{...t,activeTabIndex:r};{let r=[...t.openFiles,{file:e,content:"",path:s,originalContent:"",modified:!1}];return{...t,openFiles:r,activeTabIndex:r.length-1}}});let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&l(D.serverId,{command:"pm2-read-file",id:D.process.pm_id,relativePath:s,uuid:t.uuid,token:t.token})}}},onContextMenu:t=>{t.preventDefault(),n||E(s=>s?{...s,contextMenu:{x:t.clientX,y:t.clientY,file:e}}:null)},className:"flex items-center p-2 rounded cursor-pointer hover:bg-gray-700 text-sm min-h-[2rem] ".concat(a?"bg-blue-600 text-white":""," ").concat(e.isDirectory?"text-blue-400":"text-gray-300"),children:[(0,r.jsx)("span",{className:"mr-2",children:e.isDirectory?"\uD83D\uDCC1":"\uD83D\uDCC4"}),n?(0,r.jsx)("input",{type:"text",defaultValue:e.name,autoFocus:!0,onKeyDown:t=>{if("Enter"===t.key){let r=t.target.value.trim();r&&r!==e.name&&ev(s,r),E(e=>e?{...e,renamingFile:null}:null)}else"Escape"===t.key&&E(e=>e?{...e,renamingFile:null}:null)},onBlur:t=>{let r=t.target.value.trim();r&&r!==e.name&&ev(s,r),E(e=>e?{...e,renamingFile:null}:null)},className:"flex-1 bg-gray-600 text-white border-none outline-none px-1",onClick:e=>e.stopPropagation()}):(0,r.jsx)("span",{className:"truncate",children:e.name})]},t)})})]})})]}),(0,r.jsx)("div",{className:"w-1 bg-gray-700 cursor-col-resize hover:bg-gray-600",onMouseDown:e=>{J(!0),X(e.clientX),K(D.sidebarWidth)}})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col bg-gray-900",onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Array.from(e.dataTransfer.files).forEach(e=>eS(e))},children:D.openFiles.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-gray-800 border-b border-gray-700 flex",children:D.openFiles.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center px-3 py-2 border-r border-gray-700 cursor-pointer hover:bg-gray-700 ".concat(t===D.activeTabIndex?"bg-gray-700":""),onClick:()=>E(e=>e?{...e,activeTabIndex:t}:null),children:[(0,r.jsx)("span",{className:"text-gray-300 text-sm mr-2",children:e.file.name}),(0,r.jsxs)("div",{className:"flex items-center ml-1",children:[e.modified&&(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-1"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),E(e=>{if(!e)return null;let s=e.openFiles.filter((e,s)=>s!==t),r=e.activeTabIndex;return t===e.activeTabIndex?r=Math.max(0,t-1):t<e.activeTabIndex&&(r=e.activeTabIndex-1),0===s.length&&(r=-1),{...e,openFiles:s,activeTabIndex:r}})},className:"text-gray-500 hover:text-gray-300",children:"✕"})]})]},t))}),!d(D.openFiles[D.activeTabIndex].file.name)&&(0,r.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-0.5 flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("undo")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Undo (Ctrl+Z)",children:"↶"}),(0,r.jsx)("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("redo")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Redo (Ctrl+Y)",children:"↷"}),(0,r.jsx)("div",{className:"w-px h-4 bg-gray-600"}),(0,r.jsx)("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("cut")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Cut (Ctrl+X)",children:"✂"}),(0,r.jsx)("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("copy")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Copy (Ctrl+C)",children:"\uD83D\uDCCB"}),(0,r.jsx)("button",{onClick:()=>{document.querySelector("textarea")&&document.execCommand("paste")},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Paste (Ctrl+V)",children:"\uD83D\uDCC4"}),(0,r.jsx)("button",{onClick:()=>{let e=document.querySelector("textarea");e&&e.select()},className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Select All (Ctrl+A)",children:"☑"}),(0,r.jsx)("div",{className:"w-px h-4 bg-gray-600"}),(0,r.jsx)("button",{onClick:()=>E(e=>e?{...e,wordWrap:!e.wordWrap}:null),className:"px-2 py-1 text-sm rounded ".concat(D.wordWrap?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"),title:"Toggle Word Wrap",children:"⤶"}),(0,r.jsx)("div",{className:"w-px h-4 bg-gray-600"}),(0,r.jsx)("button",{onClick:()=>E(e=>e?{...e,sidebarVisible:!e.sidebarVisible}:null),className:"px-2 py-1 text-gray-300 hover:text-white hover:bg-gray-700 rounded text-sm",title:"Toggle Sidebar",children:"\uD83D\uDCC2"})]}),D.activeTabIndex>=0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex-1 overflow-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",style:{scrollbarWidth:"thin",scrollbarColor:"#4B5563 #1F2937",WebkitScrollbarWidth:"thin",WebkitScrollbarTrack:"background: #1F2937",WebkitScrollbarThumb:"background: #4B5563"},children:d(D.openFiles[D.activeTabIndex].file.name)?(0,r.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,r.jsx)("img",{src:D.openFiles[D.activeTabIndex].content.startsWith("data:")?D.openFiles[D.activeTabIndex].content:"data:image/".concat((e=>{var t;switch(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase()){case"jpg":case"jpeg":return"jpeg";case"png":default:return"png";case"gif":return"gif";case"bmp":return"bmp";case"webp":return"webp";case"svg":return"svg+xml"}})(D.openFiles[D.activeTabIndex].file.name),";base64,").concat(D.openFiles[D.activeTabIndex].content),className:"max-w-full max-h-full object-contain",alt:D.openFiles[D.activeTabIndex].file.name})}):(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"bg-gray-800 border-r border-gray-700 px-1 py-1 text-gray-500 text-sm font-mono select-none flex-shrink-0",children:D.openFiles[D.activeTabIndex].content.split("\n").map((e,t)=>(0,r.jsx)("div",{className:"leading-6 h-6",children:t+1},t))}),(0,r.jsx)("textarea",{value:D.openFiles[D.activeTabIndex].content,onChange:e=>E(t=>{if(!t||t.activeTabIndex<0)return t;let s=[...t.openFiles];return s[t.activeTabIndex].content=e.target.value,s[t.activeTabIndex].modified=e.target.value!==s[t.activeTabIndex].originalContent,{...t,openFiles:s}}),className:"flex-1 bg-gray-800 text-gray-100 border-0 p-1 font-mono text-sm resize-none focus:outline-none",placeholder:"Loading file content...",spellCheck:!1,style:{lineHeight:"1.5rem",whiteSpace:D.wordWrap?"pre-wrap":"pre"}})]})}),(0,r.jsxs)("div",{className:"bg-gray-800 border-t border-gray-700 px-4 py-1 flex justify-between items-center flex-shrink-0",children:[(0,r.jsx)("div",{className:"text-gray-400 text-xs",children:d(D.openFiles[D.activeTabIndex].file.name)?"Image file • ".concat(D.openFiles[D.activeTabIndex].file.name):"".concat(D.openFiles[D.activeTabIndex].content.length," characters • ").concat(D.openFiles[D.activeTabIndex].file.name)}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("button",{disabled:d(D.openFiles[D.activeTabIndex].file.name),onClick:()=>{let e=D.openFiles[D.activeTabIndex],t=p.find(e=>e.id===D.serverId);if(t&&i(D.serverId)){let s=d(e.file.name)?e.content:btoa(e.content);l(D.serverId,{command:"pm2-write-file",id:D.process.pm_id,relativePath:e.path,content:s,uuid:t.uuid,token:t.token}),F("File saved successfully"),setTimeout(()=>F(null),3e3),E(e=>{if(!e||e.activeTabIndex<0)return e;let t=[...e.openFiles];return t[e.activeTabIndex].originalContent=t[e.activeTabIndex].content,t[e.activeTabIndex].modified=!1,{...e,openFiles:t}})}},className:"px-4 py-1 text-sm rounded ".concat(d(D.openFiles[D.activeTabIndex].file.name)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:"Save"})})]})]})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC4"}),(0,r.jsx)("div",{children:"Select a file from the explorer to view its contents"})]})})})]})]})}),(null==D?void 0:D.contextMenu)&&(0,r.jsx)("div",{className:"fixed z-50 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 min-w-[160px]",style:{left:Math.min(D.contextMenu.x,window.innerWidth-180),top:Math.min(D.contextMenu.y,window.innerHeight-200)},children:D.contextMenu.file?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eg(e),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter folder name:");e&&ef(e),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),(0,r.jsx)("button",{onClick:()=>{var e;let t=D.contextMenu.file.isDirectory?D.contextMenu.file.path:D.contextMenu.file.path.split("/").slice(0,-1).join("/")||"";E(e=>e?{...e,uploadTargetPath:t,contextMenu:null}:null),null===(e=B.current)||void 0===e||e.click()},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Upload File"}),(0,r.jsx)("div",{className:"border-t border-gray-600 my-1"}),D.contextMenu.file.isDirectory?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name;E(t=>t?{...t,currentPath:e,contextMenu:null}:null);let t=p.find(e=>e.id===D.serverId);t&&i(D.serverId)&&l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:e,uuid:t.uuid,token:t.token})},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Open"}),(0,r.jsx)("div",{className:"border-t border-gray-600 my-1"}),(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter file name:");if(e){let t=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name,"/").concat(e):"".concat(D.contextMenu.file.name,"/").concat(e),s=p.find(e=>e.id===D.serverId);if(s&&i(D.serverId)){let e="local"===D.serverId?localStorage.getItem("accessToken"):s.token;l(D.serverId,{command:"pm2-create-file",id:D.process.pm_id,relativePath:t,content:"",uuid:s.uuid,token:e}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500)}}E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter folder name:");if(e){let t=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name,"/").concat(e):"".concat(D.contextMenu.file.name,"/").concat(e),s=p.find(e=>e.id===D.serverId);if(s&&i(D.serverId)){let e="local"===D.serverId?localStorage.getItem("accessToken"):s.token;l(D.serverId,{command:"pm2-create-folder",id:D.process.pm_id,relativePath:t,uuid:s.uuid,token:e}),setTimeout(()=>{l(D.serverId,{command:"pm2-list-files",id:D.process.pm_id,relativePath:D.currentPath,uuid:s.uuid,token:s.token})},500)}}E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),(0,r.jsx)("div",{className:"border-t border-gray-600 my-1"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name;E(t=>t?{...t,contextMenu:null,renamingFile:e}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Rename"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name;E(t=>t?{...t,contextMenu:null,renamingFile:e}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Rename"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name,t=prompt("Enter zip file name:","".concat(D.contextMenu.file.name,".zip"));t&&eN([e],t),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Zip Folder"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name;confirm("Delete folder ".concat(D.contextMenu.file.name," and all its contents?"))&&ey([e]),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:"Delete"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eg(e),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter folder name:");e&&ef(e),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),(0,r.jsx)("div",{className:"border-t border-gray-600 my-1"}),(0,r.jsx)("button",{onClick:()=>{eb([D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name]),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Copy"}),(0,r.jsx)("button",{onClick:()=>{ej([D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name]),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Cut"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name;E(t=>t?{...t,contextMenu:null,renamingFile:e}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Rename"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name;confirm("Delete ".concat(D.contextMenu.file.name,"?"))&&ey([e]),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700",children:"Delete"}),(0,r.jsx)("button",{onClick:()=>{let e=D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name,t=prompt("Enter zip file name:","".concat(D.contextMenu.file.name,".zip"));t&&eN([e],t),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Zip"}),D.contextMenu.file.name.endsWith(".zip")&&(0,r.jsx)("button",{onClick:()=>{ek(D.currentPath?"".concat(D.currentPath,"/").concat(D.contextMenu.file.name):D.contextMenu.file.name),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Unzip"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter file name:");e&&eg(e),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New File"}),(0,r.jsx)("button",{onClick:()=>{let e=prompt("Enter folder name:");e&&ef(e),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"New Folder"}),(0,r.jsx)("button",{onClick:()=>{var e;E(e=>e?{...e,uploadTargetPath:"",contextMenu:null}:null),null===(e=B.current)||void 0===e||e.click()},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Upload File"}),D.clipboard&&(0,r.jsx)("button",{onClick:()=>{ew(),E(e=>e?{...e,contextMenu:null}:null)},className:"block w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700",children:"Paste"})]})}),M&&(0,r.jsx)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-green-600 text-white px-6 py-3 rounded shadow-lg text-center",style:{zIndex:1e4},children:M})]})}function g(e){let{activeTab:t}=e;return(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:"Instance Management"}),(0,r.jsx)("p",{className:"text-gray-400",children:"Instance management features coming soon..."})]})}function f(e){let{activeTab:t}=e,{user:s}=(0,a.a)(),[l,i]=(0,n.useState)([]),[c,o]=(0,n.useState)(!0),[d,u]=(0,n.useState)(null),[m,x]=(0,n.useState)({name:"",role:"",status:0});(0,n.useEffect)(()=>{p()},[]);let p=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch("http://".concat("192.168.100.193",":").concat("5000","/users"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok){let e=await t.json();i(e.data)}}catch(e){console.error("Failed to fetch users:",e)}finally{o(!1)}},h=e=>!!s&&s.id!==e.id&&("OWNER"===s.role||"ADMIN"===s.role&&"MEMBER"===e.role),g=e=>!!s&&s.id!==e.id&&("OWNER"===s.role||"ADMIN"===s.role&&"MEMBER"===e.role),f=e=>{h(e)&&(u(e.id),x({name:e.name||"",role:e.role,status:e.status}))},v=()=>{u(null),x({name:"",role:"",status:0})},y=async e=>{try{let t=localStorage.getItem("accessToken"),s=await fetch("http://".concat("192.168.100.193",":").concat("5000","/users/").concat(e.id),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({name:m.name})});g(e)&&m.role!==e.role&&await fetch("http://".concat("192.168.100.193",":").concat("5000","/users/").concat(e.id,"/role"),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({role:m.role})}),m.status!==e.status&&await fetch("http://".concat("192.168.100.193",":").concat("5000","/users/").concat(e.id,"/status"),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({status:m.status})}),s.ok&&(p(),v())}catch(e){console.error("Failed to update user:",e)}};return c?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-white",children:"User Manager"}),(0,r.jsx)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Name"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Username"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Email"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Role"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Created"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:l.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:d===e.id?(0,r.jsx)("input",{type:"text",value:m.name,onChange:e=>x({...m,name:e.target.value}),className:"bg-gray-700 text-white px-2 py-1 rounded"}):e.name||"N/A"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.username}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.email}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:d===e.id&&g(e)?(0,r.jsxs)("select",{value:m.role,onChange:e=>x({...m,role:e.target.value}),className:"bg-gray-700 text-white px-2 py-1 rounded",children:[(0,r.jsx)("option",{value:"MEMBER",children:"Member"}),(0,r.jsx)("option",{value:"ADMIN",children:"Admin"}),(null==s?void 0:s.role)==="OWNER"&&(0,r.jsx)("option",{value:"OWNER",children:"Owner"})]}):e.role}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:d===e.id?(0,r.jsxs)("select",{value:m.status,onChange:e=>x({...m,status:parseInt(e.target.value)}),className:"bg-gray-700 text-white px-2 py-1 rounded",children:[(0,r.jsx)("option",{value:-1,children:"Banned"}),(0,r.jsx)("option",{value:0,children:"Inactive"}),(0,r.jsx)("option",{value:1,children:"Active"})]}):-1===e.status?"Banned":0===e.status?"Inactive":"Active"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-300",children:new Date(e.created_at).toLocaleDateString()}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:d===e.id?(0,r.jsxs)("div",{className:"space-x-2",children:[(0,r.jsx)("button",{onClick:()=>y(e),className:"text-green-400 hover:text-green-300",children:"Save"}),(0,r.jsx)("button",{onClick:v,className:"text-red-400 hover:text-red-300",children:"Cancel"})]}):h(e)&&(0,r.jsx)("button",{onClick:()=>f(e),className:"text-blue-400 hover:text-blue-300",children:"Edit"})})]},e.id))})]})})]})}let v="http://".concat("192.168.100.193",":").concat("5000"),y=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("".concat(v,"/users"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok)return(await t.json()).data;throw Error("Failed to fetch users")},b=async()=>{let e={id:"local",servername:"Local Server",url:"ws://".concat("192.168.100.193",":").concat("5000"),uuid:"local-server",token:"local-token",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{let t=localStorage.getItem("accessToken"),s=await fetch("".concat(v,"/wservers"),{headers:{Authorization:"Bearer ".concat(t)}});if(!s.ok)return[e];{let t=(await s.json()).data||[];return[e,...t]}}catch(t){return console.error("Failed to fetch wservers:",t),[e]}},j=async()=>{let e=localStorage.getItem("accessToken"),t=await fetch("".concat(v,"/pm2-permissions"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok)return await t.json();throw Error("Failed to fetch permissions")},w=async e=>{let t=localStorage.getItem("accessToken"),s=await fetch("".concat(v,"/pm2-permissions/user/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(s.ok)return await s.json();throw Error("Failed to fetch my permissions")},N=async(e,t)=>{let s=localStorage.getItem("accessToken"),r=await fetch("".concat(v,"/pm2-permissions/user/").concat(e,"/server/").concat(t),{headers:{Authorization:"Bearer ".concat(s)}});if(r.ok)return await r.json();throw Error("Failed to fetch current permissions")},k=async(e,t,s,r)=>{let a=localStorage.getItem("accessToken");if(!(await fetch("".concat(v,"/pm2-permissions/upsert"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({userId:e,wserverId:t,pm2ProcessName:s,permissions:r})})).ok)throw Error("Failed to save permissions")},S=async e=>{let t=localStorage.getItem("accessToken");if(!(await fetch("".concat(v,"/pm2-permissions/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).ok)throw Error("Failed to delete permission")},I=[{value:"view",label:"View PM2 Process"},{value:"control",label:"Control (Start/Stop/Restart/Send)"},{value:"edit_note",label:"Edit Notes"},{value:"control_file",label:"Control Files"},{value:"save_resurrect",label:"Save/Resurrect"}],P=e=>{let[t,s]=(0,n.useState)([]),[r,a]=(0,n.useState)([]),[l,i]=(0,n.useState)([]),[c,o]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,x]=(0,n.useState)(""),[p,h]=(0,n.useState)(""),[g,f]=(0,n.useState)([]),[v,P]=(0,n.useState)([]),[C,T]=(0,n.useState)(!1),[D,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{let[e,t,r]=await Promise.all([y(),b(),j()]);s(e),a(t.filter(e=>"Local Server"!==e.servername)),i(r)}catch(e){console.error("Failed to load initial data:",e)}finally{u(!1)}})()},[]),(0,n.useEffect)(()=>{e&&w(e.id).then(o).catch(e=>console.error("Failed to fetch my permissions:",e))},[e]),(0,n.useEffect)(()=>{m&&p&&g.length>0?N(m,p).then(e=>{let t=e.filter(e=>g.includes(e.pm2ProcessName));0===t.length?P([]):1===t.length?P(t[0].permissions):P(t[0].permissions.filter(e=>t.every(t=>t.permissions.includes(e))))}).catch(e=>{console.error("Failed to fetch current permissions:",e),P([])}):P([])},[m,p,g]),(0,n.useEffect)(()=>{if(D){let e=setTimeout(()=>E(null),3e3);return()=>clearTimeout(e)}},[D]);let M=async()=>{if(m&&p&&0!==g.length){T(!0);try{let e=g.map(e=>k(m,p,e,v));await Promise.all(e);let t=await j();i(t),E({message:"Permissions saved for ".concat(g.length," process(es)"),type:"success"})}catch(e){console.error("Failed to save permissions:",e),E({message:"Failed to save permissions",type:"error"})}finally{T(!1)}}};return{users:t,wservers:r,permissions:l,myPermissions:c,permissionOptions:I,loading:d,selectedUser:m,selectedServer:p,selectedProcesses:g,currentPermissions:v,saving:C,toast:D,setSelectedUser:x,setSelectedServer:h,setSelectedProcesses:f,togglePermission:e=>{P(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleSavePermissions:M,handleDeletePermission:async e=>{if(confirm("Are you sure you want to delete this permission?"))try{await S(e);let t=await j();i(t)}catch(e){console.error("Failed to delete permission:",e),alert("Failed to delete permission")}},selectAllProcesses:e=>{g.length===e.length?f([]):f(e.map(e=>e.name))},selectAllPermissions:()=>{v.length===I.length?P([]):P(I.map(e=>e.value))}}};function C(e){let{myPermissions:t,permissionOptions:s}=e;return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,r.jsx)("h4",{className:"text-lg font-medium text-white mb-4",children:"My PM2 Permissions"}),0===t.length?(0,r.jsx)("p",{className:"text-gray-400",children:"You don't have any PM2 permissions assigned yet."}):(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>{var t;return(0,r.jsxs)("div",{className:"bg-gray-700 rounded p-4",children:[(0,r.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"text-white font-medium",children:e.pm2ProcessName}),(0,r.jsxs)("p",{className:"text-gray-400 text-sm",children:["Server: ",(null===(t=e.wserver)||void 0===t?void 0:t.servername)||e.wserverId]})]})}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.permissions.map(e=>{var t;return(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-600 text-xs rounded",children:(null===(t=s.find(t=>t.value===e))||void 0===t?void 0:t.label)||e},e)})})]},e.id)})})]})}function T(e){let{users:t,wservers:s,pm2Processes:a,permissionOptions:n,selectedUser:l,selectedServer:i,selectedProcesses:c,currentPermissions:o,saving:d,fetchingProcesses:u,onUserChange:m,onServerChange:x,onProcessToggle:p,onSelectAllProcesses:h,onPermissionToggle:g,onSelectAllPermissions:f,onSave:v}=e;return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,r.jsx)("h4",{className:"text-lg font-medium text-white mb-4",children:"Set Permissions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"User"}),(0,r.jsxs)("select",{value:l,onChange:e=>m(e.target.value),className:"w-full bg-gray-700 text-white px-3 py-2 rounded",children:[(0,r.jsx)("option",{value:"",children:"Select User"}),t.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.username," (",e.email,")"]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Server"}),(0,r.jsxs)("select",{value:i,onChange:e=>x(e.target.value),className:"w-full bg-gray-700 text-white px-3 py-2 rounded",children:[(0,r.jsx)("option",{value:"",children:"Select Server"}),s.map(e=>(0,r.jsx)("option",{value:e.id,children:e.servername},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["PM2 Processes",a.length>0&&(0,r.jsx)("button",{onClick:h,className:"ml-2 text-xs text-blue-400 hover:text-blue-300",children:c.length===a.length?"Unselect All":"Select All"})]}),(0,r.jsx)("div",{className:"max-h-32 overflow-y-auto bg-gray-700 rounded p-2",children:u?(0,r.jsx)("div",{className:"text-gray-400 text-sm",children:"Loading processes..."}):0===a.length?(0,r.jsx)("div",{className:"text-gray-400 text-sm",children:"No processes found"}):a.map(e=>(0,r.jsxs)("label",{className:"flex items-center mb-1",children:[(0,r.jsx)("input",{type:"checkbox",checked:c.includes(e.name),onChange:()=>p(e.name),className:"mr-2"}),(0,r.jsx)("span",{className:"text-white text-sm",children:e.name})]},e.name))})]})]}),l&&i&&c.length>0&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:"Permissions"}),(0,r.jsx)("button",{onClick:f,className:"text-xs text-blue-400 hover:text-blue-300",children:o.length===n.length?"Unselect All":"Select All"})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:n.map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:o.includes(e.value),onChange:()=>g(e.value),className:"mr-2"}),(0,r.jsx)("span",{className:"text-white",children:e.label})]},e.value))})]}),(0,r.jsx)("button",{onClick:v,disabled:d||!l||!i||0===c.length,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:d?"Saving...":"Save Permissions"})]})}function D(e){let{permissions:t,permissionOptions:s,onDeletePermission:a}=e;return(0,r.jsx)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"User"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Server"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Process"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Permissions"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsxs)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:[t.map(e=>{var t,n;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:(null===(t=e.user)||void 0===t?void 0:t.username)||e.userId}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:(null===(n=e.wserver)||void 0===n?void 0:n.servername)||e.wserverId}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.pm2ProcessName}),(0,r.jsx)("td",{className:"px-6 py-4 text-white",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:e.permissions.map(e=>{var t;return(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-600 text-xs rounded",children:(null===(t=s.find(t=>t.value===e))||void 0===t?void 0:t.label)||e},e)})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsx)("button",{onClick:()=>a(e.id),className:"text-red-400 hover:text-red-300",children:"Delete"})})]},e.id)}),0===t.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-400",children:"No permissions configured"})})]})]})})}function E(e){let{toast:t}=e;return t?(0,r.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,r.jsx)("div",{className:"px-4 py-2 rounded shadow-lg text-white ".concat("success"===t.type?"bg-green-600":"bg-red-600"),children:t.message})}):null}function M(e){let{activeTab:t}=e,{user:s}=(0,a.a)(),{connectToServer:l,sendToServer:i,isConnected:o}=c(),[d,u]=(0,n.useState)([]),[m,x]=(0,n.useState)(!1),p=(0,n.useRef)(null),h=(0,n.useRef)(0),{users:g,wservers:f,permissions:v,myPermissions:y,permissionOptions:b,loading:j,selectedUser:w,selectedServer:N,selectedProcesses:k,currentPermissions:S,saving:I,toast:M,setSelectedUser:F,setSelectedServer:A,setSelectedProcesses:_,togglePermission:O,handleSavePermissions:R,handleDeletePermission:z,selectAllProcesses:W,selectAllPermissions:U}=P(s),L=(0,n.useCallback)((e,t)=>{try{let s=JSON.parse(e.data);"pm2-getlist"===s.type&&t===N&&(u(s.data||[]),x(!1),p.current=N,h.current=Date.now())}catch(e){console.error("Failed to parse WebSocket message:",e),x(!1)}},[N]);return((0,n.useEffect)(()=>{if(N){let e=Date.now();if(p.current===N&&e-h.current<3e4&&d.length>0){x(!1);return}x(!0);let t=f.find(e=>e.id===N);t&&l(t,L,(e,t)=>{let s="local"===N?localStorage.getItem("accessToken"):t.token;i(N,{uuid:t.uuid,token:s,command:"pm2-getlist",timestamp:Date.now()})})}else u([]),x(!1)},[N,l,i,f,L,d.length]),j)?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-white",children:"User PM2 Permissions"}),s&&"MEMBER"===s.role&&(0,r.jsx)(C,{myPermissions:y,permissionOptions:b}),((null==s?void 0:s.role)==="ADMIN"||(null==s?void 0:s.role)==="OWNER")&&(0,r.jsx)(T,{users:g,wservers:f,pm2Processes:d,permissionOptions:b,selectedUser:w,selectedServer:N,selectedProcesses:k,currentPermissions:S,saving:I,fetchingProcesses:m,onUserChange:F,onServerChange:A,onProcessToggle:e=>{_(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onSelectAllProcesses:()=>W(d),onPermissionToggle:O,onSelectAllPermissions:U,onSave:R}),((null==s?void 0:s.role)==="ADMIN"||(null==s?void 0:s.role)==="OWNER")&&(0,r.jsx)(D,{permissions:v,permissionOptions:b,onDeletePermission:z}),(0,r.jsx)(E,{toast:M})]})}let F="http://".concat("192.168.100.193",":").concat("5000"),A=async(e,t,s)=>{let r=localStorage.getItem("accessToken"),a=new URLSearchParams({limit:t.toString(),offset:((e-1)*t).toString()});s.username&&a.append("username",s.username),s.resource&&a.append("resource",s.resource),s.startDate&&a.append("startDate",s.startDate+"T00:00:00.000Z"),s.endDate&&a.append("endDate",s.endDate+"T23:59:59.999Z");let n=await fetch("".concat(F,"/audit/logs?").concat(a),{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(n.ok)return await n.json();throw Error("Failed to fetch audit logs")},_=()=>{let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!0),[a,l]=(0,n.useState)(1),[i,c]=(0,n.useState)(1),[o,d]=(0,n.useState)(0),[u,m]=(0,n.useState)({username:"",resource:"",startDate:"",endDate:""});return(0,n.useEffect)(()=>{let e=new Date,t=new Date(e.getTime()-6048e5).toISOString().split("T")[0],s=e.toISOString().split("T")[0];m(e=>({...e,startDate:t,endDate:s}))},[]),(0,n.useEffect)(()=>{(async()=>{try{r(!0);let e=await A(a,20,u);t(e.logs),d(e.total),c(e.totalPages)}catch(e){console.error("Failed to fetch audit logs:",e)}finally{r(!1)}})()},[a,u]),{logs:e,loading:s,currentPage:a,totalPages:i,total:o,filters:u,handleFilterChange:e=>{m(e),l(1)},handlePageChange:e=>{l(e)},resetPage:()=>{l(1)}}};function O(e){let{filters:t,tempFilters:s,onTempFiltersChange:a,onApplyFilters:n}=e;return(0,r.jsx)("div",{className:"bg-gray-800 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),(0,r.jsx)("input",{type:"text",value:s.username,onChange:e=>a({...s,username:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter username"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Resource"}),(0,r.jsxs)("select",{value:s.resource,onChange:e=>a({...s,resource:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"",children:"All Resources"}),(0,r.jsx)("option",{value:"USER",children:"User"}),(0,r.jsx)("option",{value:"AUTH",children:"Auth"}),(0,r.jsx)("option",{value:"SESSION",children:"Session"}),(0,r.jsx)("option",{value:"PASSWORD",children:"Password"}),(0,r.jsx)("option",{value:"EMAIL",children:"Email"}),(0,r.jsx)("option",{value:"TWO_FA",children:"Two FA"}),(0,r.jsx)("option",{value:"SYSTEM",children:"System"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Start Date"}),(0,r.jsx)("input",{type:"date",value:s.startDate,onChange:e=>a({...s,startDate:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"End Date"}),(0,r.jsx)("input",{type:"date",value:s.endDate,onChange:e=>a({...s,endDate:e.target.value}),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsx)("button",{onClick:n,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Filter"})})]})})}function R(e){let{logs:t,onRowDoubleClick:s}=e;return(0,r.jsx)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-gray-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Time"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"User"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Action"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Resource"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Details"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"IP"}),(0,r.jsx)("th",{className:"px-6 py-3 text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Success"})]})}),(0,r.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:t.map(e=>(0,r.jsxs)("tr",{onDoubleClick:()=>s(e),className:"cursor-pointer hover:bg-gray-700 transition-colors",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-300",children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.user?e.user.username:"System"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.action}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-white",children:e.resource}),(0,r.jsx)("td",{className:"px-6 py-4 text-white max-w-xs truncate",children:e.details}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-gray-300",children:e.ipAddress||"N/A"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(e.isSuccess?"bg-green-800 text-green-200":"bg-red-800 text-red-200"),children:e.isSuccess?"Success":"Failed"})})]},e.id))})]})})}function z(e){let{currentPage:t,totalPages:s,total:a,logsCount:n,onPageChange:l}=e;return(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"text-gray-300",children:["Showing ",n>0?(t-1)*20+1:0," to ",Math.min(20*t,a)," of ",a," entries"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:()=>l(t-1),disabled:1===t,className:"px-4 py-2 bg-gray-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600",children:"Previous"}),(0,r.jsxs)("span",{className:"text-white",children:["Page ",t," of ",s]}),(0,r.jsx)("button",{onClick:()=>l(t+1),disabled:t>=s,className:"px-4 py-2 bg-gray-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-600",children:"Next"})]})]})}function W(e){let{selectedLog:t,isOpen:s,onClose:a}=e;return s&&t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white",children:"Audit Log Details"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-white text-2xl",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Log ID"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:t.id})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Created At"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:new Date(t.createdAt).toLocaleString()})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"User"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:t.user?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Username:"})," ",t.user.username]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Name:"})," ",t.user.name]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",t.user.email]})]}):"System"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Action & Resource"}),(0,r.jsxs)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Action:"})," ",t.action]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Resource:"})," ",t.resource]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Success:"})," ",t.isSuccess?"Yes":"No"]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Details"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md whitespace-pre-wrap",children:t.details})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"IP Address"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:t.ipAddress||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"User Agent"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md text-sm",children:t.userAgent||"N/A"})]})]}),t.sessionId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Session ID"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md font-mono text-sm",children:t.sessionId})]}),t.metadata&&Object.keys(t.metadata).length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Metadata"}),(0,r.jsx)("div",{className:"text-white bg-gray-700 px-3 py-2 rounded-md",children:(0,r.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(t.metadata,null,2)})})]})]}),(0,r.jsx)("div",{className:"flex justify-end mt-6",children:(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Close"})})]})}):null}function U(e){let{activeTab:t}=e,{logs:s,loading:a,currentPage:l,totalPages:i,total:c,filters:o,handleFilterChange:d,handlePageChange:u,resetPage:m}=_(),[x,p]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),[f,v]=(0,n.useState)({username:"",resource:"",startDate:"",endDate:""});return((0,n.useEffect)(()=>{v(o)},[o]),a)?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-white",children:"Admin Log"}),(0,r.jsx)(O,{filters:o,tempFilters:f,onTempFiltersChange:v,onApplyFilters:()=>{d(f),m()}}),(0,r.jsx)(R,{logs:s,onRowDoubleClick:e=>{p(e),g(!0)}}),(0,r.jsx)(z,{currentPage:l,totalPages:i,total:c,logsCount:s.length,onPageChange:u}),(0,r.jsx)(W,{selectedLog:x,isOpen:h,onClose:()=>{g(!1),p(null)}})]})}var L=s(3511);let B="force-dynamic";function V(){let{user:e,logout:t,isLoading:s}=(0,a.a)(),[l,i]=(0,n.useState)("pm2"),c=(0,x.useRouter)();(0,n.useEffect)(()=>{{let e=localStorage.getItem("activeTab");e&&i(e)}},[]),(0,n.useEffect)(()=>{s||e||c.push("/")},[e,s,c]),(0,n.useEffect)(()=>{e&&!("ADMIN"===e.role||"OWNER"===e.role)&&("wserver"===l||"usermanager"===l||"userpermissions"===l||"adminlog"===l)&&i("pm2")},[e,l]);let d=e=>{i(e),localStorage.setItem("activeTab",e)};return s?(0,r.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):e?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,r.jsx)(L.Z,{user:e,logout:t}),(0,r.jsx)("main",{className:"flex-1",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-white mb-8",children:"Dashboard"}),(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)("div",{className:"border-b border-gray-700",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("button",{onClick:()=>d("wserver"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("wserver"===l?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"),children:"WServer"}),(0,r.jsx)("button",{onClick:()=>d("pm2"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("pm2"===l?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"),children:"PM2"}),(0,r.jsx)("button",{onClick:()=>d("instance"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("instance"===l?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"),children:"Instance"}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("button",{onClick:()=>d("usermanager"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("usermanager"===l?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"),children:"User Manager"}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("button",{onClick:()=>d("userpermissions"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("userpermissions"===l?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"),children:"User Permissions"}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("button",{onClick:()=>d("adminlog"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("adminlog"===l?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300"),children:"Admin Log"})]})})}),(0,r.jsx)(m,{children:(0,r.jsx)(o,{user:e,children:(0,r.jsxs)("div",{className:"tab-content",children:[e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("div",{className:"wserver"===l?"":"hidden",children:(0,r.jsx)(p,{activeTab:l,user:e})}),(0,r.jsx)("div",{className:"pm2"===l?"":"hidden",children:(0,r.jsx)(h,{activeTab:l,user:e})}),(0,r.jsx)("div",{className:"instance"===l?"":"hidden",children:(0,r.jsx)(g,{activeTab:l})}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("div",{className:"usermanager"===l?"":"hidden",children:(0,r.jsx)(f,{activeTab:l})}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("div",{className:"userpermissions"===l?"":"hidden",children:(0,r.jsx)(M,{activeTab:l})}),e&&("ADMIN"===e.role||"OWNER"===e.role)&&(0,r.jsx)("div",{className:"adminlog"===l?"":"hidden",children:(0,r.jsx)(U,{activeTab:l})})]})})})]})}),(0,r.jsx)("footer",{className:"bg-gray-800 border-t border-gray-700",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"text-center text-gray-400",children:(0,r.jsx)("p",{children:"\xa9 2024 MeoPanel Client. All rights reserved."})})})})]}):null}},2949:function(e,t,s){"use strict";var r,a;e.exports=(null==(r=s.g.process)?void 0:r.env)&&"object"==typeof(null==(a=s.g.process)?void 0:a.env)?s.g.process:s(3862)},3862:function(e){!function(){var t={229:function(e){var t,s,r,a=e.exports={};function n(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var c=[],o=!1,d=-1;function u(){o&&r&&(o=!1,r.length?c=r.concat(c):d=-1,c.length&&m())}function m(){if(!o){var e=i(u);o=!0;for(var t=c.length;t;){for(r=c,c=[];++d<t;)r&&r[d].run();d=-1,t=c.length}r=null,o=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function x(e,t){this.fun=e,this.array=t}function p(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new x(e,t)),1!==c.length||o||i(m)},x.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=p,a.addListener=p,a.once=p,a.off=p,a.removeListener=p,a.removeAllListeners=p,a.emit=p,a.prependListener=p,a.prependOnceListener=p,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},s={};function r(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}},l=!0;try{t[e](n,n.exports,r),l=!1}finally{l&&delete s[e]}return n.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[678,115,364,744],function(){return e(e.s=3195)}),_N_E=e.O()}]);